(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{105:function(e,t,a){e.exports=a.p+"static/media/carback.d753e984.jpg"},187:function(e,t,a){},218:function(e,t){},275:function(e,t,a){e.exports=a(501)},296:function(e,t,a){},500:function(e,t,a){},501:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(16),i=a.n(r),c=(a(187),a(44)),l=a(47),s=a(57),u=a(61),m=a(58),d=a(62),g=a(74),h=a(41),f=a.n(h),p=a(10),b=a(196),v=a(545),y=a(227),E=a(542),O=a(546),w=a(560),x=a(544),j=a(92),I=a(543),S=a(85),_=a.n(S),T=a(105),N=a.n(T),C=(a(296),function(e){return o.a.createElement("div",{className:"loader-container"},o.a.createElement("div",{className:"loader"},o.a.createElement("div",{className:"ellipse"}),o.a.createElement("div",{className:"ellipse"}),o.a.createElement("div",{className:"ellipse"}),o.a.createElement("div",{className:"ellipse"}),o.a.createElement("div",{className:"ellipse"})),o.a.createElement("p",{style:{color:"white",fontSize:"2rem",marginTop:"4rem"}}," ",e.message," "))}),k=a(17),A=a.n(k);function M(){return o.a.createElement(j.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",o.a.createElement(E.a,{color:"inherit",href:"https://fluxauto.xyz/"},"www.fluxauto.xyz")," ",(new Date).getFullYear(),".")}var L=Object(I.a)(function(e){return{root:{height:"100vh"},image:{backgroundImage:"url(".concat(_.a,")"),backgroundRepeat:"no-repeat",backgroundColor:"black",backgroundSize:"500px 500px",backgroundPosition:"center"},paper:{margin:e.spacing(8,4),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},maindiv:{backgroundImage:"url(".concat(N.a,")")}}});function R(e){var t=L(),a=Object(n.useState)(!1),r=Object(p.a)(a,2),i=r[0],c=r[1],l=Object(n.useState)(null),s=Object(p.a)(l,2),u=s[0],m=s[1];return i?o.a.createElement(C,{message:"sending reset link to the email address"}):o.a.createElement(x.a,{container:!0,component:"main",className:t.root},o.a.createElement(v.a,null),o.a.createElement(x.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),o.a.createElement(x.a,{item:!0,xs:12,sm:8,md:5,component:O.a,elevation:6,square:!0},o.a.createElement("div",{className:t.paper},o.a.createElement("div",null,o.a.createElement("h2",{className:"w3-text-red"},"AUTO"),o.a.createElement("h2",null,"ANNOTATION")),o.a.createElement(j.a,{component:"h1",variant:"h5"},"FORGOT PASSWORD"),o.a.createElement("form",{className:t.form},o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",onChange:function(e){m(e.target.value)},autoFocus:!0,required:!0}),o.a.createElement(b.a,{type:"submit",fullWidth:!0,onClick:function(e){e.preventDefault(),null!=u?(c(!0),f.a.post("/user/forgot-password",{email:u}).then(function(e){(e.data.message="recovery mail sent")&&(c(!1),A()({title:"Recovery mail sent check yor mail",icon:"success",buttons:!0}))}).catch(function(e){c(!1),A()({title:e.message,icon:"warning",buttons:!0})})):A()({title:"All fields are Mandatory",icon:"warning",buttons:!0})},variant:"contained",color:"primary",className:t.submit},"submit"),o.a.createElement(w.a,{mt:5},o.a.createElement(M,null))))))}var P=a(64),D=a(24),W=a.n(D),B=a(66),G=a(91),z={margin:"1em",fontSize:"24px"},H=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).state={username:"",password:"",confirmPassword:"",updated:!1,isLoading:!0,error:!1},e.handleSubmit=e.handleSubmit.bind(Object(g.a)(Object(g.a)(e))),e.handleChange=e.handleChange.bind(Object(g.a)(Object(g.a)(e))),e}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Object(B.a)(W.a.mark(function e(){var t,a;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.match.params.token,e.prev=1,e.next=4,f.a.get("/user/reset",{params:{resetPasswordToken:t}});case 4:"password reset link a-ok"===(a=e.sent).data.message&&(console.log(a.data.username),this.setState({username:a.data.username,updated:!1,isLoading:!1,error:!1})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0.response.data),this.setState({updated:!1,isLoading:!1,error:!0});case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){console.log(e.target.name),this.setState(Object(P.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(){var e=Object(B.a)(W.a.mark(function e(t){var a,n,o,r,i;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=this.state,n=a.username,o=a.password,r=this.props.match.params.token,e.prev=3,e.next=6,f.a.put("/user/forgot-password-update",{username:n,password:o,resetPasswordToken:r});case 6:i=e.sent,console.log(i.data),"password reset successfully"===i.data.message?(this.setState({updated:!0,error:!1}),this.props.history.push("/")):this.setState({updated:!1,error:!0}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.log(e.t0.response.data);case 14:case"end":return e.stop()}},e,this,[[3,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.password,a=e.error,n=e.isLoading,r=e.updated,i=e.confirmPassword;return a?o.a.createElement("div",null,o.a.createElement("div",{style:z},o.a.createElement("h4",null,"Problem resetting password. Please send another reset link."))):n?o.a.createElement("div",null,o.a.createElement("div",{style:z},"Loading User Data...")):o.a.createElement("div",null,o.a.createElement("h4",null,"Reset Password"),o.a.createElement("form",{className:"form-horizontal",onSubmit:this.handleSubmit},o.a.createElement("div",{className:"form-group"},o.a.createElement("div",{className:"col-1 col-ml-auto"},o.a.createElement("label",{className:"form-label",htmlFor:"password"},"New Password")),o.a.createElement("div",{className:"col-3 col-mr-auto"},o.a.createElement("input",{className:"form-input",placeholder:"password",type:"password",name:"password",value:t,onChange:this.handleChange,required:"required"}))),o.a.createElement("div",{className:"form-group"},o.a.createElement("div",{className:"col-1 col-ml-auto"},o.a.createElement("label",{className:"form-label",htmlFor:"username"},"Confirm New Password")),o.a.createElement("div",{className:"col-3 col-mr-auto"},o.a.createElement("input",{className:"form-input",type:"password",name:"confirmPassword",placeholder:"Confirm Password",value:i,onChange:this.handleChange,required:"required"}))),o.a.createElement("div",{className:"form-group "},o.a.createElement("div",{className:"col-7"}),o.a.createElement("button",{className:"btn btn-primary col-1 col-mr-auto",type:"submit"},"Submit"))),r&&o.a.createElement("div",null,o.a.createElement("p",null,"Your password has been successfully reset, please try logging in again.")))}}]),t}(n.Component),V=Object(G.f)(H);function F(){return o.a.createElement(j.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",o.a.createElement(E.a,{color:"inherit",href:"https://fluxauto.xyz/"},"www.fluxauto.xyz")," ",(new Date).getFullYear(),".")}var U=Object(I.a)(function(e){return{root:{height:"100vh"},image:{backgroundImage:"url(".concat(_.a,")"),backgroundRepeat:"no-repeat",backgroundColor:"black",backgroundSize:"500px 500px",backgroundPosition:"center"},paper:{margin:e.spacing(8,4),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},maindiv:{backgroundImage:"url(".concat(N.a,")")}}});function Y(e){var t=U(),a=Object(n.useState)(!1),r=Object(p.a)(a,2),i=r[0],c=r[1],l=Object(n.useState)(""),s=Object(p.a)(l,2),u=s[0],m=s[1],d=Object(n.useState)(""),g=Object(p.a)(d,2),h=g[0],I=g[1],S=Object(n.useState)(""),_=Object(p.a)(S,2),T=_[0],N=_[1],k=Object(n.useState)(null),M=Object(p.a)(k,2),L=M[0],R=M[1],P=Object(n.useState)(""),D=Object(p.a)(P,2),W=D[0],B=D[1],z=Object(n.useState)(""),H=Object(p.a)(z,2),V=H[0],Y=H[1],J=Object(n.useState)(""),q=Object(p.a)(J,2),K=q[0],X=q[1],Z=Object(n.useState)(null),$=Object(p.a)(Z,2),Q=$[0],ee=$[1];return L?o.a.createElement(G.a,{to:{pathname:L}}):i?o.a.createElement(C,{message:"signing up please wait"}):o.a.createElement(x.a,{container:!0,component:"main",className:t.root},o.a.createElement(v.a,null),o.a.createElement(x.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),o.a.createElement(x.a,{item:!0,xs:12,sm:8,md:5,component:O.a,elevation:6,square:!0},o.a.createElement("div",{className:t.paper},o.a.createElement("div",null,o.a.createElement("h2",{className:"w3-text-red"},"AUTO"),o.a.createElement("h2",null,"ANNOTATION")),o.a.createElement(j.a,{component:"h1",variant:"h5"},"Sign up"),o.a.createElement("form",{className:t.form},o.a.createElement(x.a,{container:!0,spacing:2},o.a.createElement(x.a,{item:!0,xs:12,sm:6},o.a.createElement(y.a,{autoComplete:"fname",name:"firstName",variant:"outlined",required:!0,fullWidth:!0,id:"firstName",onChange:function(e){B(e.target.value)},label:"First Name",autoFocus:!0})),o.a.createElement(x.a,{item:!0,xs:12,sm:6},o.a.createElement(y.a,{variant:"outlined",required:!0,fullWidth:!0,id:"lastName",label:"Last Name",name:"lastName",onChange:function(e){Y(e.target.value)},autoComplete:"lname"}))),o.a.createElement(y.a,{autoComplete:"uname",margin:"normal",onChange:function(e){m(e.target.value)},name:"username",variant:"outlined",required:!0,fullWidth:!0,id:"username",label:"User Name",autoFocus:!0}),o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",onChange:function(e){ee(e.target.value)},autoFocus:!0,required:!0}),o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,id:"mobile",label:"Phone",name:"mobile",autoComplete:"mobile",onChange:function(e){X(e.target.value)},autoFocus:!0,required:!0}),o.a.createElement(x.a,{container:!0,spacing:2},o.a.createElement(x.a,{item:!0,xs:12,sm:6},o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",onChange:function(e){I(e.target.value)},autoComplete:"current-password",required:!0})),o.a.createElement(x.a,{item:!0,xs:12,sm:6},o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,name:"confirmPassword",label:"Confirm Password",type:"password",id:"password",onChange:function(e){N(e.target.value)},autoComplete:"current-password",required:!0}))),o.a.createElement(b.a,{type:"submit",fullWidth:!0,onClick:function(e){console.log("sign-up handleSubmit, username: "),console.log(u),e.preventDefault(),u&&h&&T&&K&&Q&&W&&null!==V?h!==T?alert("Passwords did not match"):(c(!0),f.a.post("/user/",{username:u,password:h,confirmPassword:T,firstName:W,lastName:V,email:Q,mobile:K}).then(function(e){e.data.error?(c(!1),A()({title:"username already exists",icon:"warning",buttons:!0})):(c(!1),console.log("successful signup"),R("/"))}).catch(function(e){c(!1);var t=e.response.data.errors;A()({title:t[0].msg,icon:"warning",buttons:!0})})):A()({title:"All fields are Mandatory",icon:"warning",buttons:!0})},variant:"contained",color:"primary",className:t.submit},"Sign Up"),o.a.createElement(x.a,{container:!0},o.a.createElement(x.a,{item:!0},o.a.createElement(E.a,{href:"/",variant:"body2"},"Have an account? Sign In"))),o.a.createElement(w.a,{mt:5},o.a.createElement(F,null))))))}var J=a(14),q=a(11),K=a(233),X=a.n(K),Z=a(506),$=a(552),Q=a(107),ee=a(40),te=a.n(ee),ae=a(26),ne=Object(I.a)({container:{margin:8},header:{display:"flex",flexDirection:"row",alignItems:"center",padding:8,paddingLeft:16,paddingRight:16},title:{fontSize:14,fontWeight:"bold",flexGrow:1,paddingLeft:8,color:Q.a[800],"& span":{color:Q.a[600],fontSize:12}},expandButton:{padding:0,width:30,height:30,"& .icon":{marginTop:-6,width:20,height:20,transition:"500ms transform","&.expanded":{transform:"rotate(180deg)"}}},expandedContent:{maxHeight:300,overflowY:"auto","&.noScroll":{overflowY:"visible",overflow:"visible"}}}),oe=Object(n.memo)(function(e){var t=e.icon,a=e.title,r=e.subTitle,i=e.children,c=e.noScroll,l=void 0!==c&&c,s=e.expandedByDefault,u=void 0!==s&&s,m=ne(),d=o.a.createElement("div",{className:te()(m.expandedContent,l&&"noScroll")},i),g=Object(n.useState)(u),h=Object(p.a)(g,2),f=h[0],b=h[1],v=Object(ae.a)(function(){return b(!f)});return o.a.createElement(O.a,{className:m.container},o.a.createElement("div",{className:m.header},t,o.a.createElement("div",{className:m.title},a," ",o.a.createElement("span",null,r)),o.a.createElement(Z.a,{onClick:v,className:m.expandButton},o.a.createElement(X.a,{className:te()("icon",f&&"expanded")}))),l?f?d:null:o.a.createElement($.a,{in:f},d))},function(e,t){return e.title===t.title&&e.children===t.children}),re=a(123),ie=a.n(re),ce=a(259),le=a(138),se=a.n(le),ue=Object(ce.a)("div")({paddingLeft:16,paddingRight:16,fontSize:12,"& h1":{fontSize:18},"& h2":{fontSize:14},"& h3":{fontSize:12},"& h4":{fontSize:12},"& h5":{fontSize:12},"& h6":{fontSize:12},"& p":{fontSize:12},"& a":{},"& img":{width:"100%"}}),me=(Object(n.memo)(function(e){var t=e.description;return o.a.createElement(oe,{title:"Task Description",icon:o.a.createElement(ie.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},o.a.createElement(ue,null,o.a.createElement(se.a,{source:t})))}),a(234)),de=a.n(me),ge=a(551),he=a(553),fe=a(217),pe=a(79),be=a.n(pe),ve=Object(I.a)({img:{width:40,height:40,borderRadius:8}}),ye=function(e){return[e.name,(e.regions||[]).length,e.src]},Ee=Object(n.memo)(function(e){var t=e.images,a=e.onSelect,n=ve();return o.a.createElement(oe,{title:"Images",subTitle:"(".concat(t.length,")"),icon:o.a.createElement(de.a,{style:{color:Q.a[700]}})},o.a.createElement("div",null,o.a.createElement(ge.a,null,t.map(function(e,t){return o.a.createElement(he.a,{button:!0,onClick:function(){return a(e)},dense:!0,key:t},o.a.createElement("img",{className:n.img,src:e.src}),o.a.createElement(fe.a,{primary:e.name,secondary:"".concat((e.regions||[]).length," Labels")}))}))))},function(e,t){return be()(e.images.map(ye),t.images.map(ye))}),Oe=a(239),we=a.n(Oe),xe=a(235),je=a.n(xe),Ie=a(236),Se=a.n(Ie),_e=a(88),Te=a.n(_e),Ne=a(115),Ce=a.n(Ne),ke=a(237),Ae=a.n(ke),Me=a(170),Le=a.n(Me),Re=a(238),Pe=a.n(Re),De=a(112),We={container:{fontSize:11,fontWeight:"bold",color:Q.a[700],"& .icon":{marginTop:4,width:16,height:16},"& .icon2":{opacity:.5,width:16,height:16,transition:"200ms opacity","&:hover":{cursor:"pointer",opacity:1}}},row:{padding:4,cursor:"pointer","&.header:hover":{backgroundColor:"#fff"},"&.highlighted":{backgroundColor:De.a[100]},"&:hover":{backgroundColor:De.a[50],color:Q.a[800]}},chip:{display:"flex",flexDirection:"row",padding:2,borderRadius:2,paddingLeft:4,paddingRight:4,alignItems:"center","& .color":{borderRadius:5,width:10,height:10,marginRight:4},"& .text":{}}},Be=Object(I.a)(We),Ge=Object(ce.a)("div")({borderTop:"1px solid ".concat(Q.a[200]),marginTop:2,marginBottom:2}),ze=function(e){var t=e.color,a=e.text,n=Be();return o.a.createElement("span",{className:n.chip},o.a.createElement("div",{className:"color",style:{backgroundColor:t}}),o.a.createElement("div",{className:"text"},a))},He=function(e){var t=e.header,a=e.highlighted,r=e.order,i=e.classification,c=e.area,l=(e.tags,e.trash),s=e.lock,u=e.visible,m=e.onClick,d=Be(),g=Object(n.useState)(!1),h=Object(p.a)(g,2),f=(h[0],h[1]);return o.a.createElement("div",{onClick:m,onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},className:te()(d.row,{header:t,highlighted:a})},o.a.createElement(x.a,{container:!0,alignItems:"center"},o.a.createElement(x.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:10}},r)),o.a.createElement(x.a,{item:!0,xs:5},i),o.a.createElement(x.a,{item:!0,xs:2},o.a.createElement("div",{style:{textAlign:"right",paddingRight:6}},c)),o.a.createElement(x.a,{item:!0,xs:1},l),o.a.createElement(x.a,{item:!0,xs:1},s),o.a.createElement(x.a,{item:!0,xs:1},u)))},Ve=Object(n.memo)(function(){return o.a.createElement(He,{header:!0,highlighted:!1,order:o.a.createElement(je.a,{className:"icon"}),classification:o.a.createElement("div",{style:{paddingLeft:10}},"Class"),area:o.a.createElement(Se.a,{className:"icon"}),trash:o.a.createElement(Te.a,{className:"icon"}),lock:o.a.createElement(Ce.a,{className:"icon"}),visible:o.a.createElement(Le.a,{className:"icon"})})}),Fe=Object(n.memo)(function(e){var t=e.region,a=e.highlighted,n=e.onSelectRegion,r=e.onDeleteRegion,i=e.onChangeRegion,c=(e.visible,e.locked,e.color),l=e.cls,s=e.index;return o.a.createElement(He,{header:!1,highlighted:a,onClick:function(){return n(t)},order:"#".concat(s+1),classification:o.a.createElement(ze,{text:l||"",color:c||"#ddd"}),area:"",trash:o.a.createElement(Te.a,{onClick:function(){return r(t)},className:"icon2"}),lock:t.locked?o.a.createElement(Ce.a,{onClick:function(){return i(Object(q.a)({},t,{locked:!1}))},className:"icon2"}):o.a.createElement(Ae.a,{onClick:function(){return i(Object(q.a)({},t,{locked:!0}))},className:"icon2"}),visible:t.visible||void 0===t.visible?o.a.createElement(Le.a,{onClick:function(){return i(Object(q.a)({},t,{visible:!1}))},className:"icon2"}):o.a.createElement(Pe.a,{onClick:function(){return i(Object(q.a)({},t,{visible:!0}))},className:"icon2"})})},function(e,t){return e.highlighted===t.highlighted&&e.visible===t.visible&&e.locked===t.locked&&e.id===t.id&&e.index===t.index&&e.cls===t.cls&&e.color===t.color}),Ue=function(e){return[e.id,e.color,e.locked,e.visible,e.highlighted]},Ye=Object(n.memo)(function(e){var t=e.regions,a=e.onDeleteRegion,n=e.onChangeRegion,r=e.onSelectRegion,i=Be();return o.a.createElement(oe,{title:"Regions",subTitle:"",icon:o.a.createElement(we.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},o.a.createElement("div",{className:i.container},o.a.createElement(Ve,null),o.a.createElement(Ge,null),t.map(function(e,t){return o.a.createElement(Fe,Object.assign({key:e.id},e,{region:e,index:t,onSelectRegion:r,onDeleteRegion:a,onChangeRegion:n}))})))},function(e,t){return be()(e.regions.map(Ue),t.regions.map(Ue))}),Je=a(240),qe=a.n(Je),Ke=a(554),Xe=a(166),Ze=a.n(Xe),$e=a(116),Qe=a.n($e),et=Object(I.a)({emptyText:{fontSize:14,fontWeight:"bold",color:Q.a[500],textAlign:"center",padding:20}}),tt=Object(n.memo)(function(e){var t=e.history,a=e.onRestoreHistory,n=et();return o.a.createElement(oe,{title:"History",icon:o.a.createElement(qe.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},o.a.createElement(ge.a,null,0===t.length&&o.a.createElement("div",{className:n.emptyText},"No History Yet"),t.map(function(e,t){var n=e.name,r=e.time;return o.a.createElement(he.a,{button:!0,dense:!0,key:t},o.a.createElement(fe.a,{primary:n,secondary:Qe()(r).format("LT")}),0===t&&o.a.createElement(Ke.a,{onClick:function(){return a()}},o.a.createElement(Z.a,null,o.a.createElement(Ze.a,null))))})))},function(e,t){return be()(e.history.map(function(e){return[e.name,e.time]}),t.history.map(function(e){return[e.name,e.time]}))}),at=function(e){var t=e.state,a=e.lastAction,n=(t.images||[]).find(function(e){return e.src===t.selectedImage}),r=n?(n.regions||[]).find(function(e){return e.highlighted}):null;return o.a.createElement(oe,{title:"Debug",icon:o.a.createElement("span",null),expandedByDefault:!0},o.a.createElement("div",{style:{padding:4}},o.a.createElement("div",null,o.a.createElement("b",null,"region"),":"),o.a.createElement("pre",null,JSON.stringify(r,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"lastAction"),":"),o.a.createElement("pre",null,JSON.stringify(a,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"mode"),":"),o.a.createElement("pre",null,JSON.stringify(t.mode,null,"  ")),o.a.createElement("div",null,o.a.createElement("b",null,"frame:")),o.a.createElement("pre",null,JSON.stringify(t.selectedImageFrameTime,null,"  "))))},nt=a(241),ot=a.n(nt),rt=a(65),it=a(8),ct=a.n(it),lt=(Object(I.a)({}),[]),st=Object(n.memo)(function(e){var t=e.currentImage,a=e.imageClsList,r=void 0===a?lt:a,i=e.imageTagList,c=void 0===i?lt:i,l=e.onChangeImage;if(!t)return null;var s=t.tags,u=void 0===s?[]:s,m=t.cls,d=void 0===m?null:m,g=Object(ae.a)(function(e){return l({cls:e.value})}),h=Object(ae.a)(function(e){return l({tags:e.map(function(e){return e.value})})}),f=Object(n.useMemo)(function(){return d?{value:d,label:d}:null},[d]),p=Object(n.useMemo)(function(){return Object(it.asMutable)(r.map(function(e){return{value:e,label:e}}))},[r]),b=Object(n.useMemo)(function(){return Object(it.asMutable)(c.map(function(e){return{value:e,label:e}}))},[c]),v=Object(n.useMemo)(function(){return u.map(function(e){return{value:e,label:e}})},[u]);return o.a.createElement(oe,{title:"Image Tags",expandedByDefault:!0,noScroll:!0,icon:o.a.createElement(ot.a,{style:{color:Q.a[700]}})},r.length>0&&o.a.createElement("div",{style:{padding:8}},o.a.createElement(rt.a,{placeholder:"Image Classification",onChange:g,value:f,options:p})),c.length>0&&o.a.createElement("div",{style:{padding:8,paddingTop:0}},o.a.createElement(rt.a,{isMulti:!0,placeholder:"Image Tags",onChange:h,value:v,options:b})))},function(e,t){return e.currentImage.cls===t.currentImage.cls&&e.currentImage.tags===t.currentImage.tags&&e.imageClsList===t.imageClsList&&e.imageTagList===t.imageTagList}),ut=a(242),mt=a.n(ut),dt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e<1e3)return e+"ms";var a=e/1e3;if(a<60)return Number.isInteger(a)?a+"s":a.toFixed(t)+"s";var n=a/60;return Number.isInteger(n)?n+"m":n.toFixed(t)+"m"},gt=Object(ce.a)("div")({cursor:"pointer",display:"flex",alignItems:"center",padding:8,fontSize:14,color:Q.a[700],"&.current":{backgroundColor:De.a[100]},"&:hover":{backgroundColor:Q.a[100]},"& .time":{flexGrow:1,fontWeight:"bold","& .regionCount":{marginLeft:8,fontWeight:"normal",color:Q.a[500]}},"& .trash":{"& .icon":{fontSize:18,color:Q.a[600],transition:"transform 80ms","&:hover":{color:Q.a[800],transform:"scale(1.25,1.25)"}}}}),ht=function(e){var t=e.currentVideoTime,a=e.keyframes,n=e.onChangeVideoTime,r=e.onDeleteKeyframe,i=Object.keys(a).map(function(e){return parseInt(e)});return o.a.createElement(oe,{title:"Keyframes",subTitle:"",icon:o.a.createElement(mt.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},i.map(function(e){return o.a.createElement(gt,{fullWidth:!0,key:e,className:t===e?"current":"",onClick:function(){return n(e)}},o.a.createElement("div",{className:"time"},dt(e,2),o.a.createElement("span",{className:"regionCount"},"(",(a[e].regions||[]).length,")")),o.a.createElement("div",{className:"trash"},o.a.createElement(Te.a,{onClick:function(t){r(e),t.stopPropagation()},className:"icon"})))}))},ft=(Object(I.a)({shortcutKeyFieldWrapper:{paddingTop:8,display:"inline-flex",width:"100%"},shortcutKeyText:{lineHeight:0},shortcutTextfield:{width:"100%",boxSizing:"border-box",textAlign:"center"}}),a(260)),pt=a(559),bt=Object(ce.a)("div")({"& > div":{width:"100%",height:"100%"}}),vt=function(e){var t=e.children,a=Object(ft.a)(e,["children"]),r=Object(n.useState)(!1),i=Object(p.a)(r,2),c=i[0],l=i[1],s=Object(ae.a)(function(e){c||l(!0),a.onMouseMove&&a.onMouseMove(e)}),u=Object(ae.a)(function(e){setTimeout(function(){c&&l(!1)},100)});return o.a.createElement(bt,Object.assign({},a,{onMouseMove:s,onMouseLeave:u}),o.a.createElement(pt.a,{enabled:c,removeScrollBar:!1},t))},yt=a(243),Et=a.n(yt),Ot=function(e){var t=e.handlePreview,a=e.previewImages;return o.a.createElement(oe,{title:"Review",icon:o.a.createElement(Et.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},a.length>0&&o.a.createElement("table",{className:"w3-table"},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"sl.No"),o.a.createElement("th",null,"Images"))),o.a.createElement("tbody",null,a.map(function(e,a){return o.a.createElement("tr",{onClick:function(){return t(e)}},o.a.createElement("td",null,a+1),o.a.createElement("td",{className:"w3-hover-grey"},e))}))))},wt=(Object(n.memo)(Ot),a(218),function(e){var t=e.allowed_metadata,a=e.metadata,n=e.onChange;return o.a.createElement(oe,{title:"Meta Data",icon:o.a.createElement(ie.a,{style:{color:Q.a[700]}}),expandedByDefault:!0},o.a.createElement("label",null,"Climate"),o.a.createElement(rt.a,{className:"w3-margin-bottom w3-margin-left w3-margin-right",placeholder:"Classification",onChange:function(e){return n(Object(q.a)({},a,{climate:e.value}))},value:a.climate?{label:a.climate,value:a.climate}:null,options:Object(it.asMutable)(t.climate.map(function(e){return{value:e,label:e}}))}),o.a.createElement("label",null,"Road"),o.a.createElement(rt.a,{className:"w3-margin-bottom w3-margin-left w3-margin-right",placeholder:"Classification",onChange:function(e){return n(Object(q.a)({},a,{road:e.value}))},value:a.road?{label:a.road,value:a.road}:null,options:Object(it.asMutable)(t.road.map(function(e){return{value:e,label:e}}))}),o.a.createElement("label",null,"Time of Day"),o.a.createElement(rt.a,{className:"w3-margin-bottom w3-margin-left w3-margin-right",placeholder:"Classification",onChange:function(e){return n(Object(q.a)({},a,{time_of_day:e.value}))},value:a.time_of_day?{label:a.time_of_day,value:a.time_of_day}:null,options:Object(it.asMutable)(t.time_of_day.map(function(e){return{value:e,label:e}}))}),o.a.createElement("label",null,"Area"),o.a.createElement(rt.a,{className:"w3-margin-bottom w3-margin-left w3-margin-right",placeholder:"Classification",onChange:function(e){return n(Object(q.a)({},a,{area:e.value}))},value:a.area?{label:a.area,value:a.area}:null,options:Object(it.asMutable)(t.area.map(function(e){return{value:e,label:e}}))}),o.a.createElement("div",null,o.a.createElement("label",null,"Number of Lanes"),o.a.createElement("input",{className:"w3-button w3-border w3-margin-bottom",placeholder:"no. of Lanes",type:"number",onChange:function(e){return n(Object(q.a)({},a,{no_of_lanes:e.currentTarget.value}))}})),o.a.createElement("div",null,o.a.createElement("label",null,"Number of classes"),o.a.createElement("input",{className:"w3-button w3-border w3-margin-bottom ",placeholder:"no. of classes",type:"number",onChange:function(e){return n(Object(q.a)({},a,{no_of_classes:e.currentTarget.value}))}})))}),xt=(Object(n.memo)(wt),Object(I.a)({})),jt=[],It=function(e){var t=e.metadata,a=e.allowed_metadata,n=e.preview,r=e.previewList,i=e.debug,c=(e.taskDescription,e.keyframes),l=e.images,s=e.regions,u=e.history,m=e.labelImages,d=e.currentImage,g=e.currentVideoTime,h=e.imageClsList,f=e.imageTagList,p=e.onChangeMetadata,b=e.onChangeImage,v=e.onSelectRegion,y=e.onSelectImage,E=e.onChangeRegion,O=e.onDeleteRegion,w=e.onRestoreHistory,x=e.onChangeVideoTime,j=e.onDeleteKeyframe;e.onShortcutActionDispatched,xt();return s||(s=jt),o.a.createElement("div",null,o.a.createElement(wt,{allowed_metadata:a,metadata:null===t?{climate:"None",road:"None",time_of_day:"None",area:"None",no_of_classes:0,no_of_lanes:0}:t,onChange:p}),o.a.createElement(Ot,{handlePreview:n,previewImages:r}),i&&o.a.createElement(at,{state:i,lastAction:i.lastAction}),m&&o.a.createElement(st,{currentImage:d,imageClsList:h,imageTagList:f,onChangeImage:b,expandedByDefault:!0}),l&&l.length>1&&o.a.createElement(Ee,{onSelect:y,images:l}),o.a.createElement(Ye,{regions:s,onSelectRegion:v,onChangeRegion:E,onDeleteRegion:O}),o.a.createElement(tt,{history:u,onRestoreHistory:function(){return w()}}),c&&o.a.createElement(ht,{currentVideoTime:g,keyframes:c,onChangeVideoTime:x,onDeleteKeyframe:j}))},St=a(147),_t=(a(447),function(e){var t=e.mousePosition,a=e.x,r=e.y,i=Object(n.useState)(),c=Object(p.a)(i,2),l=(c[0],c[1]);return t&&(a=t.current.x,r=t.current.y),Object(n.useEffect)(function(){if(t){var e=setInterval(function(){a===t.current.x&&r===t.current.y||l([t.current.x,t.current.y])},10);return function(){return clearInterval(e)}}}),o.a.createElement(n.Fragment,null,o.a.createElement("div",{style:{position:"absolute",height:"100%",width:1,zIndex:10,backgroundColor:"#f00",left:a,pointerEvents:"none",top:0}}),o.a.createElement("div",{style:{position:"absolute",width:"100%",zIndex:10,height:1,backgroundColor:"#f00",top:r,pointerEvents:"none",left:0}}))}),Tt={regionInfo:{fontSize:12,cursor:"default",transition:"opacity 200ms",opacity:.7,"&:hover":{opacity:.9,cursor:"pointer"},"&.highlighted":{opacity:.9,"&:hover":{opacity:1}},fontWeight:600,color:Q.a[900],padding:8,"& .name":{display:"flex",flexDirection:"row",alignItems:"center","& .circle":{marginRight:4,boxShadow:"0px 0px 2px rgba(0,0,0,0.4)",width:10,height:10,borderRadius:5}},"& .tags":{"& .tag":{color:Q.a[700],display:"inline-block",margin:1,fontSize:10,textDecoration:"underline"}}}},Nt=a(167),Ct=a.n(Nt),kt=Object(I.a)(Tt),At=Object(n.memo)(function(e){var t=e.region,a=e.editing,n=e.allowedClasses,r=e.allowedTags,i=e.onDelete,c=e.onChange,l=e.onClose,s=e.onOpen,u=kt();return o.a.createElement(O.a,{onKeyPress:function(e){e.stopPropagation()},onKeyDown:function(e){e.stopPropagation()},onKeyUp:function(e){e.stopPropagation()},onClick:function(){return a?null:s(t)},className:te()(u.regionInfo,{highlighted:t.highlighted})},a?o.a.createElement("div",{style:{width:200}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{display:"flex",backgroundColor:t.color,color:"#fff",padding:4,paddingLeft:8,paddingRight:8,borderRadius:4,fontWeight:"bold",textShadow:"0px 0px 5px rgba(0,0,0,0.4)"}},t.type),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(Z.a,{onClick:function(){return i(t)},tabIndex:-1,style:{width:22,height:22},size:"small",variant:"outlined"},o.a.createElement(Te.a,{style:{marginTop:-8,width:16,height:16}}))),(n||[]).length>0&&o.a.createElement("div",{style:{marginTop:6}},o.a.createElement(rt.a,{placeholder:"Classification",onChange:function(e){return c(Object(q.a)({},t,{cls:e.value}))},value:t.cls?{label:t.cls,value:t.cls}:null,options:Object(it.asMutable)(n.map(function(e){return{value:e,label:e}}))})),(r||[]).length>0&&o.a.createElement("div",{style:{marginTop:4}},o.a.createElement(rt.a,{onChange:function(e){return c(Object(q.a)({},t,{tags:e.map(function(e){return e.value})}))},placeholder:"Tags",value:(t.tags||[]).map(function(e){return{label:e,value:e}}),isMulti:!0,options:Object(it.asMutable)(r.map(function(e){return{value:e,label:e}}))})),o.a.createElement("div",{style:{marginTop:4,display:"flex"}},o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(b.a,{onClick:function(){return l(t)},size:"small",variant:"contained",color:"primary"},o.a.createElement(Ct.a,null)))):o.a.createElement("div",null,t.cls&&o.a.createElement("div",{className:"name"},o.a.createElement("div",{className:"circle",style:{backgroundColor:t.color}}),t.cls),t.tags&&o.a.createElement("div",{className:"tags"},t.tags.map(function(e){return o.a.createElement("div",{key:e,className:"tag"},e)}))))},function(e,t){return e.editing===t.editing&&e.region.x===t.region.x&&e.region.y===t.region.y&&e.region.tags===t.region.tags&&e.region.cls===t.region.cls&&e.region.color===t.region.color&&e.region.highlighted===t.region.highlighted}),Mt=Object(I.a)({"@keyframes borderDance":{from:{strokeDashoffset:0},to:{strokeDashoffset:100}},highlightBox:{zIndex:2,transition:"opacity 500ms","&.highlighted":{zIndex:3},"&:not(.highlighted)":{opacity:0},"&:not(.highlighted):hover":{opacity:.6},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,stroke:"#FFF",fill:"none",strokeDasharray:5,animationName:"$borderDance",animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}}),Lt=function(e){var t=e.mouseEvents,a=e.dragWithPrimary,n=e.zoomWithPrimary,r=e.createWithPrimary,i=e.onBeginMovePoint,c=e.onSelectRegion,l=e.region,s=e.pbox,u=Mt();return o.a.createElement("svg",Object.assign({key:l.id,className:te()(u.highlightBox,{highlighted:l.highlighted})},t,n||a?{}:{onMouseDown:function(e){return!l.locked&&"point"===l.type&&l.highlighted&&0===e.button?i(l):0!==e.button||r?void t.onMouseDown(e):c(l)}},{style:Object(q.a)({},l.highlighted?{pointerEvents:"point"!==l.type?"none":void 0,cursor:"grab"}:{cursor:n||a||r?void 0:"pointer",pointerEvents:n||a||r&&!l.highlighted?"none":void 0},{position:"absolute",left:s.x-5,top:s.y-5,width:s.w+10,height:s.h+10})}),o.a.createElement("path",{d:"M5,5 L".concat(s.w+5,",5 L").concat(s.w+5,",").concat(s.h+5," L5,").concat(s.h+5," Z")}))},Rt=a(562),Pt=a(555),Dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,a="undefined"!==typeof window,o=Object(Rt.a)({width:a?window.innerWidth:e,height:a?window.innerHeight:t}),r=Object(p.a)(o,2),i=r[0],c=r[1];return Object(n.useEffect)(function(){if(a){var e=function(){c({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}},[]),Object(Pt.a)(function(){a&&(window.innerWidth===i.width&&window.innerHeight===i.height||c({width:window.innerWidth,height:window.innerHeight}))},100),i},Wt=function(e){var t=e.canvasEl,a=e.changeMat,o=e.changeDragging,r=e.zoomStart,i=(e.zoomEnd,e.changeZoomStart),c=e.changeZoomEnd,l=e.layoutParams,s=e.zoomWithPrimary,u=e.dragWithPrimary,m=e.mat,d=e.onMouseMove,g=e.onMouseUp,h=e.onMouseDown,f=e.dragging,p=Object(n.useRef)({x:0,y:0}),b=Object(n.useRef)({x:0,y:0}),v=function(e,t){var n=[t.x,t.y],o=n[0],r=n[1],i="object"===typeof e?e.to/m.a:1+.2*e;m.translate(o,r).scaleU(i),m.a>2&&m.scaleU(2/m.a),m.a<.1&&m.scaleU(.1/m.a),m.translate(-o,-r),a(m.clone())};return{mouseEvents:{onMouseMove:function(e){var n=t.current.getBoundingClientRect(),o=n.left,i=n.top;b.current.x=p.current.x,b.current.y=p.current.y,p.current.x=e.clientX-o,p.current.y=e.clientY-i;var u=m.applyToPoint(p.current.x,p.current.y);s&&r&&c(u);var g=l.current,h=g.iw,v=g.ih;d({x:u.x/h,y:u.y/v}),f&&(m.translate(b.current.x-p.current.x,b.current.y-p.current.y),a(m.clone())),e.preventDefault()},onMouseDown:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.preventDefault(),1===e.button||0===e.button&&u)return o(!0);var a=m.applyToPoint(p.current.x,p.current.y);if(s&&0===e.button)return i(a),void c(a);if(0===e.button){t.type,t.type;var n=l.current,r=n.iw,d=n.ih;h({x:a.x/r,y:a.y/d})}},onMouseUp:function(e){e.preventDefault();var t=m.applyToPoint(p.current.x,p.current.y);if(r){var n=t;if(Math.abs(r.x-n.x)<10&&Math.abs(r.y-n.y)<10)m.a<1?v({to:1},p.current):v({to:.25},p.current);else{var s=l.current,d=s.iw,h=s.ih;if(r.x>n.x){var f=[n.x,r.x];r.x=f[0],n.x=f[1]}if(r.y>n.y){var b=[n.y,r.y];r.y=b[0],n.y=b[1]}var y=Math.min((n.x-r.x)/d,(n.y-r.y)/h);y<.1&&(y=.1),y>10&&(y=10);var E=St.Matrix.from(1,0,0,1,-10,-10).translate(r.x,r.y).scaleU(y);a(E.clone())}i(null),c(null)}if(1===e.button||0===e.button&&u)return o(!1);if(0===e.button){var O=l.current,w=O.iw,x=O.ih;g({x:t.x/w,y:t.y/x})}},onWheel:function(e){var t=e.deltaY>0?1:e.deltaY<0?-1:0;v(t,p.current)}},mousePosition:p}},Bt=function(e){var t=e.layoutParams,a=e.mat;return Object(ae.a)(function(e){var n=t.current,o=n.iw,r=n.ih,i=function(e){switch(e.type){case"polygon":var t={x:Math.min.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1],a}))),y:Math.min.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2);return t[0],t[1]}))),w:0,h:0};return t.w=Math.max.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1],a})))-t.x,t.h=Math.max.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2);return t[0],t[1]})))-t.y,t;case"box":return{x:e.x,y:e.y,w:e.w,h:e.h};case"point":return{x:e.x,y:e.y,w:0,h:0};case"pixel":if(void 0!==e.sx&&void 0!==e.sy&&e.w&&e.h)return{x:e.sx,y:e.sy,w:e.w,h:e.h};if(e.points){var a={x:Math.min.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1],a}))),y:Math.min.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2);return t[0],t[1]}))),w:0,h:0};return a.w=Math.max.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2),a=t[0];return t[1],a})))-a.x,a.h=Math.max.apply(Math,Object(J.a)(e.points.map(function(e){var t=Object(p.a)(e,2);return t[0],t[1]})))-a.y,a}}throw new Error("unknown region")}(e),c="point"===e.type?15:2,l={x:i.x*o-c,y:i.y*r-c,w:i.w*o+2*c,h:i.h*r+2*c};return Object(q.a)({},a.clone().inverse().applyToPoint(l.x,l.y),{w:l.w/a.a,h:l.h/a.d})})},Gt=Object(ce.a)("svg")({pointerEvents:"none",position:"absolute",zIndex:1,left:0,top:0,width:"100%",height:"100%","& text":{fill:"#fff"},"& path":{vectorEffect:"non-scaling-stroke",strokeWidth:2,opacity:.5,stroke:"#FFF",fill:"none",strokeDasharray:5,animationDuration:"4s",animationTimingFunction:"linear",animationIterationCount:"infinite",animationPlayState:"running"}}),zt=function(e){var t=e.projectRegionBox,a=e.regions,r=e.pointDistancePrecision,i=e.realSize;return o.a.createElement(Gt,null,a.filter(function(e){return"point"===e.type}).flatMap(function(e,c){return a.filter(function(e,t){return t>c}).filter(function(e){return"point"===e.type}).map(function(a){var c,l=t(e),s=t(a),u={x:(l.x+l.w/2+s.x+s.w/2)/2,y:(l.y+l.h/2+s.y+s.h/2)/2};if(i){var m=i.w,d=i.h,g=i.unitName;c=Math.sqrt(Math.pow(e.x*m-a.x*m,2)+Math.pow(e.y*d-a.y*d,2)).toFixed(r)+g}else c=(100*Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2))).toFixed(r)+"%";return o.a.createElement(n.Fragment,null,o.a.createElement("path",{d:"M".concat(l.x+l.w/2,",").concat(l.y+l.h/2," L").concat(s.x+s.w/2,",").concat(s.y+s.h/2)}),o.a.createElement("text",{x:u.x,y:u.y},c))})}))},Ht=function(e){var t=e.regions,a=e.projectRegionBox,n=e.mouseEvents,r=e.regionClsList,i=e.regionTagList,c=e.onBeginRegionEdit,l=e.onChangeRegion,s=e.onCloseRegionEdit,u=e.onDeleteRegion,m=e.layoutParams,d=e.imageSrc,g=e.RegionEditLabel,h=null!=g?g:At;return t.filter(function(e){return e.visible||void 0===e.visible}).map(function(e){var g=a(e),f=m.current,p=(f.iw,f.ih,8);e.highlighted&&"box"===e.type&&(p+=6);var b=e.editingLabels&&!e.locked?170:e.tags?60:50,v=g.y>b,y=v?{left:g.x,top:g.y-p/2}:{left:g.x,top:g.y+g.h+p/2};return e.locked?o.a.createElement("div",{key:e.id,style:Object(q.a)({position:"absolute"},y,{zIndex:10+(e.editingLabels?5:0)})},o.a.createElement(O.a,{style:Object(q.a)({position:"absolute",left:0},v?{bottom:0}:{top:0},{zIndex:10,backgroundColor:"#fff",borderRadius:4,padding:2,paddingBottom:0,opacity:.5,pointerEvents:"none"})},o.a.createElement(Ce.a,{style:{width:16,height:16,color:"#333"}}))):o.a.createElement("div",{key:e.id,style:Object(q.a)({position:"absolute"},y,{zIndex:10+(e.editingLabels?5:0),width:200}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(e){return e.preventDefault()},onMouseEnter:function(t){e.editingLabels&&(n.onMouseUp(t),t.button=1,n.onMouseUp(t))}},o.a.createElement("div",Object.assign({style:Object(q.a)({position:"absolute",left:0},v?{bottom:0}:{top:0})},e.editingLabels?{}:function(e){for(var t=Object(q.a)({},e),a=arguments.length,n=new Array(a>1?a-1:0),o=1;o<a;o++)n[o-1]=arguments[o];for(var r=0,i=n;r<i.length;r++)delete t[i[r]];return t}(n,"onMouseDown","onMouseUp")),o.a.createElement(h,{allowedClasses:r,allowedTags:i,onOpen:c,onChange:l,onClose:s,onDelete:u,editing:e.editingLabels,region:e,regions:t,imageSrc:d})))})},Vt=Object(ce.a)("div")({width:8,height:8,zIndex:2,border:"2px solid #FFF",position:"absolute"}),Ft=[["nw-resize","n-resize","ne-resize"],["w-resize","grab","e-resize"],["sw-resize","s-resize","se-resize"]],Ut=function(e){var t=e.regions,a=e.mouseEvents,r=e.projectRegionBox,i=e.dragWithPrimary,c=e.createWithPrimary,l=e.zoomWithPrimary,s=e.onBeginMovePoint,u=e.onSelectRegion,m=e.layoutParams,d=e.mat,g=e.onBeginBoxTransform,h=e.onBeginMovePolygonPoint,f=e.onAddPolygonPoint;return t.filter(function(e){return e.visible||void 0===e.visible}).filter(function(e){return!e.locked}).map(function(e,t){var b=r(e),v=m.current,y=v.iw,E=v.ih;return o.a.createElement(n.Fragment,{key:e.id},o.a.createElement(vt,null,o.a.createElement(Lt,{region:e,mouseEvents:a,dragWithPrimary:i,createWithPrimary:c,zoomWithPrimary:l,onBeginMovePoint:s,onSelectRegion:u,pbox:b}),"box"===e.type&&!i&&!l&&!e.locked&&e.highlighted&&d.a<1.2&&[[0,0],[.5,0],[1,0],[1,.5],[1,1],[.5,1],[0,1],[0,.5],[.5,.5]].map(function(t,n){var r=Object(p.a)(t,2),i=r[0],c=r[1];return o.a.createElement(Vt,Object.assign({key:n},a,{onMouseDown:function(t){if(0===t.button)return g(e,[2*i-1,2*c-1]);a.onMouseDown(t)},style:{left:b.x-4-2+b.w*i,top:b.y-4-2+b.h*c,cursor:Ft[2*c][2*i],borderRadius:.5===i&&.5===c?4:void 0}}))}),"polygon"===e.type&&!i&&!l&&!e.locked&&e.highlighted&&e.points.map(function(t,n){var r=Object(p.a)(t,2),i=r[0],c=r[1],l=d.clone().inverse().applyToPoint(i*y,c*E);return o.a.createElement(Vt,Object.assign({key:n},a,{onMouseDown:function(t){if(0===t.button&&(!e.open||0===n))return h(e,n);a.onMouseDown(t)},style:{cursor:e.open?0===n?"pointer":void 0:"move",pointerEvents:e.open&&n===e.points.length-1?"none":void 0,left:l.x-4,top:l.y-4}}))}),"polygon"===e.type&&e.highlighted&&!i&&!l&&!e.locked&&!e.open&&e.points.length>1&&e.points.map(function(t,a){return[t,e.points[(a+1)%e.points.length]]}).map(function(e){var t=Object(p.a)(e,2),a=t[0],n=t[1];return[(a[0]+n[0])/2,(a[1]+n[1])/2]}).map(function(t,n){var r=d.clone().inverse().applyToPoint(t[0]*y,t[1]*E);return o.a.createElement(Vt,Object.assign({key:n},a,{onMouseDown:function(o){if(0===o.button)return f(e,t,n+1);a.onMouseDown(o)},style:{cursor:"copy",left:r.x-4,top:r.y-4,border:"2px dotted #fff",opacity:.5}}))})))})},Yt=Object(n.createContext)({showCrosshairs:!1}),Jt=function(){return Object(n.useContext)(Yt)},qt=function(e){var t=e.children,a=Object(n.useState)(function(){return function(){if(!window||!window.localStorage)return{};for(var e={},t=0;t<window.localStorage.length;t++){var a=window.localStorage.key(t);if(a.startsWith("settings_"))try{e[a.replace("settings_","")]=JSON.parse(window.localStorage.getItem(a))}catch(n){}}return e}()}),r=Object(p.a)(a,2),i=r[0],c=r[1];return o.a.createElement(Yt.Provider,{value:Object(q.a)({},i,{changeSetting:function(e,t){c(Object(q.a)({},i,Object(P.a)({},e,t))),window.localStorage.setItem("settings_".concat(e),JSON.stringify(t))}})},t)},Kt=Object(ce.a)("video")({zIndex:0,position:"absolute"}),Xt=Object(ce.a)("img")({zIndex:0,position:"absolute"}),Zt=function(e){var t=e.imagePosition,a=e.mouseEvents,r=e.videoTime,i=e.videoSrc,c=e.imageSrc,l=e.onLoad,s=e.videoPlaying,u=e.onChangeVideoTime,m=e.onChangeVideoPlaying,d=Jt(),g=Object(n.useRef)(),h=Object(n.useRef)();Object(n.useEffect)(function(){!s&&g.current&&(g.current.currentTime=(r||0)/1e3)},[r]),Object(n.useEffect)(function(){var e=!1;return g.current&&(s?(g.current.play(),e=!0,d.videoPlaybackSpeed&&(g.current.playbackRate=parseFloat(d.videoPlaybackSpeed))):g.current.pause()),function t(){if(e&&g.current){var a=Math.floor(1e3*g.current.currentTime);r!==a&&u(a),g.current.paused&&(e=!1,m(!1)),requestAnimationFrame(t)}}(),function(){e=!1}},[s]);var f=Object(ae.a)(function(e){var t=e.currentTarget;t.currentTime=(r||0)/1e3,l&&l({naturalWidth:t.videoWidth,naturalHeight:t.videoHeight,videoElm:t,duration:t.duration})}),p=Object(ae.a)(function(e){var t=e.currentTarget;l&&l({naturalWidth:t.naturalWidth,naturalHeight:t.naturalHeight,imageElm:t})}),b=Object(n.useMemo)(function(){var e=t.bottomRight.x-t.topLeft.x,a=t.bottomRight.y-t.topLeft.y;return{left:t.topLeft.x,top:t.topLeft.y,width:isNaN(e)?0:e,height:isNaN(a)?0:a}},[t.topLeft.x,t.topLeft.y,t.bottomRight.x,t.bottomRight.y]);return i||c?c&&void 0===r?o.a.createElement(Xt,Object.assign({},a,{src:c,ref:h,style:b,onLoad:p})):o.a.createElement(Kt,Object.assign({},a,{ref:g,style:b,onLoadedMetadata:f,src:i||c})):"No imageSrc or videoSrc provided"};function $t(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return Qt(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Qt(e,t)}(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,r=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){i=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(i)throw o}}}}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ea,ta=Object(I.a)({canvas:{width:"100%",height:"100%",position:"relative",zIndex:1},zoomIndicator:{position:"absolute",bottom:16,right:0,backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",opacity:.5,fontWeight:"bolder",fontSize:14,padding:4}}),aa=function(e){var t=e.regions,a=e.imageSrc,r=e.videoSrc,i=e.videoTime,c=e.realSize,l=e.showTags,s=e.onMouseMove,u=void 0===s?function(e){return null}:s,m=e.onMouseDown,d=void 0===m?function(e){return null}:m,g=e.onMouseUp,h=void 0===g?function(e){return null}:g,f=e.dragWithPrimary,b=void 0!==f&&f,v=e.zoomWithPrimary,y=void 0!==v&&v,E=e.createWithPrimary,O=void 0!==E&&E,w=e.pointDistancePrecision,x=void 0===w?0:w,j=e.regionClsList,I=e.regionTagList,S=e.showCrosshairs,_=e.showPointDistances,T=e.allowedArea,N=e.RegionEditLabel,C=void 0===N?null:N,k=e.videoPlaying,A=void 0!==k&&k,M=e.onImageOrVideoLoaded,L=e.onChangeRegion,R=e.onBeginRegionEdit,P=e.onCloseRegionEdit,D=e.onBeginBoxTransform,W=e.onBeginMovePolygonPoint,B=e.onAddPolygonPoint,G=e.onSelectRegion,z=e.onBeginMovePoint,H=e.onDeleteRegion,V=e.onChangeVideoTime,F=e.onChangeVideoPlaying,U=ta(),Y=Object(n.useRef)(null),K=Object(n.useRef)({}),X=Object(Rt.a)(!1),Z=Object(p.a)(X,2),$=Z[0],Q=Z[1],ee=Object(Rt.a)(0),te=Object(p.a)(ee,2),ne=te[0],oe=te[1],re=Object(Rt.a)(null),ie=Object(p.a)(re,2),ce=ie[0],le=ie[1],se=Object(Rt.a)(null),ue=Object(p.a)(se,2),me=ue[0],de=ue[1],ge=Object(Rt.a)(St.Matrix.from(1,0,0,1,-10,-10)),he=Object(p.a)(ge,2),fe=he[0],pe=he[1],be=Object(n.useRef)({}),ve=Dt(),ye=Wt({canvasEl:Y,dragging:$,mat:fe,layoutParams:K,changeMat:pe,zoomStart:ce,zoomEnd:me,changeZoomStart:le,changeZoomEnd:de,changeDragging:Q,zoomWithPrimary:y,dragWithPrimary:b,onMouseMove:u,onMouseDown:d,onMouseUp:h}),Ee=ye.mouseEvents,Oe=ye.mousePosition;Object(n.useLayoutEffect)(function(){return pe(fe.clone())},[ve]);fe.applyToPoint(Oe.current.x,Oe.current.y);var we=Bt({layoutParams:K,mat:fe}),xe=Object(n.useState)(),je=Object(p.a)(xe,2),Ie=je[0],Se=je[1],_e=Boolean(Ie&&Ie.naturalWidth),Te=Object(ae.a)(function(e){var t={naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight,duration:e.duration};M&&M(t),Se(t),setTimeout(function(){return Se(t)},10)}),Ne=function(){var e=Object(n.useRef)(null);if(null===e.current){e.current={image:new Image,pattern:null};var t=document.createElement("canvas");t.width=100,t.height=100;var a=t.getContext("2d");e.current.image.onload=function(){e.current.pattern=a.createPattern(e.current.image,"repeat")},e.current.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAB3RJTUUH4wMSAxY5oG+lzgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAcSURBVAjXY/jPwPCfAQnA+TAGugLcAhhakRUAAK3lEe8m9qZhAAAAAElFTkSuQmCC"}return e.current.pattern}(),Ce=Y.current;if(Ce&&_e){var ke=Ce.clientWidth,Ae=Ce.clientHeight,Me=Math.max(Ie.naturalWidth/(ke-20),Ie.naturalHeight/(Ae-20)),Le=Ie.naturalWidth/Me,Re=Ie.naturalHeight/Me;K.current={iw:Le,ih:Re,fitScale:Me,canvasWidth:ke,canvasHeight:Ae}}Object(n.useLayoutEffect)(function(){if(Ie){var e=Ce.clientWidth,a=Ce.clientHeight;Ce.width=e,Ce.height=a;var n=Ce.getContext("2d");n.save(),n.transform.apply(n,Object(J.a)(fe.clone().inverse().toArray()));var o=K.current,r=o.iw,i=o.ih;if(T){var c=T.x,l=T.y,s=T.w,u=T.h;n.save(),n.globalAlpha=.25;var m=[[0,0],[r,0],[r,i],[0,i]],d=[[c*r,l*i],[c*r+s*r,l*i],[c*r+s*r,l*i+u*i],[c*r,l*i+u*i]];n.moveTo.apply(n,Object(J.a)(m[0])),m.forEach(function(e){return n.lineTo.apply(n,Object(J.a)(e))}),n.lineTo.apply(n,Object(J.a)(m[0])),n.closePath(),d.reverse(),n.moveTo.apply(n,Object(J.a)(d[0])),d.forEach(function(e){return n.lineTo.apply(n,Object(J.a)(e))}),n.lineTo.apply(n,Object(J.a)(d[0])),n.fillStyle=Ne||"#f00",n.fill(),n.restore()}n.save(),n.globalAlpha=.5*fe.a+.5,n.lineWidth=1*fe.a+1,n.globalAlpha>.6&&(n.shadowColor="black",n.shadowBlur=4);var g,h=$t(t.filter(function(e){return e.visible||void 0===e.visible}));try{var f=function(){var e=g.value;switch(e.type){case"point":n.save(),n.beginPath(),n.strokeStyle=e.color,n.moveTo(e.x*r-10,e.y*i),n.lineTo(e.x*r-2,e.y*i),n.moveTo(e.x*r+10,e.y*i),n.lineTo(e.x*r+2,e.y*i),n.moveTo(e.x*r,e.y*i-10),n.lineTo(e.x*r,e.y*i-2),n.moveTo(e.x*r,e.y*i+10),n.lineTo(e.x*r,e.y*i+2),n.moveTo(e.x*r+5,e.y*i),n.arc(e.x*r,e.y*i,5,0,2*Math.PI),n.stroke(),n.restore();break;case"box":n.save(),n.shadowColor="black",n.shadowBlur=4,n.strokeStyle=e.color,n.strokeRect(e.x*r,e.y*i,e.w*r,e.h*i),n.restore();break;case"polygon":n.save(),n.shadowColor="black",n.shadowBlur=4,n.strokeStyle=e.color,n.beginPath(),n.moveTo(e.points[0][0]*r,e.points[0][1]*i);var t,a=$t(e.points);try{for(a.s();!(t=a.n()).done;){var o=t.value;n.lineTo(o[0]*r,o[1]*i)}}catch(c){a.e(c)}finally{a.f()}e.open||n.closePath(),n.stroke(),n.restore();break;case"pixel":n.save(),be.current[e.src]?"CANVAS"===be.current[e.src].nodeName&&(n.globalAlpha=.6,n.drawImage(be.current[e.src],e.sx*r,e.sy*i,e.w*r,e.h*i)):(be.current[e.src]=new Image,be.current[e.src].onload=function(){var t=be.current[e.src],a=document.createElement("canvas");a.width=t.naturalWidth,a.height=t.naturalHeight;var n=a.getContext("2d");n.drawImage(t,0,0);for(var o=n.getImageData(0,0,t.naturalWidth,t.naturalHeight),r=0;r<o.data.length;r+=4){var i=o.data.slice(r,r+4),c=Object(p.a)(i,4),l=c[0],s=c[1],u=c[2],m=(c[3],l<10&&s<10&&u<10);o.data[r]=0,o.data[r+1]=0,o.data[r+2]=m?255:0,o.data[r+3]=m?255:0}n.clearRect(0,0,t.naturalWidth,t.naturalHeight),n.putImageData(o,0,0),be.current[e.src]=a,oe(ne+1)},be.current[e.src].src=e.src),n.restore()}};for(h.s();!(g=h.n()).done;)f()}catch(b){h.e(b)}finally{h.f()}n.restore(),n.restore()}});var Pe=K.current,De=Pe.iw,We=Pe.ih,Be=ce&&me?Object(q.a)({},fe.clone().inverse().applyToPoint(ce.x,ce.y),{w:(me.x-ce.x)/fe.a,h:(me.y-ce.y)/fe.d}):null;Be&&(Be.w<0&&(Be.x+=Be.w,Be.w*=-1),Be.h<0&&(Be.y+=Be.h,Be.h*=-1));var Ge={topLeft:fe.clone().inverse().applyToPoint(0,0),bottomRight:fe.clone().inverse().applyToPoint(De,We)};return o.a.createElement("div",{style:{width:"100%",height:"100%",maxHeight:"calc(100vh - 68px)",position:"relative",overflow:"hidden",cursor:O?"crosshair":$?"grabbing":b?"grab":y?fe.a<1?"zoom-out":"zoom-in":void 0}},S&&o.a.createElement(_t,{key:"crossHairs",mousePosition:Oe}),_e&&o.a.createElement(Ut,{key:"regionSelectAndTransformBoxes",regions:t,mouseEvents:Ee,projectRegionBox:we,dragWithPrimary:b,createWithPrimary:O,zoomWithPrimary:y,onBeginMovePoint:z,onSelectRegion:G,layoutParams:K,mat:fe,onBeginBoxTransform:D,onBeginMovePolygonPoint:W,onAddPolygonPoint:B}),_e&&l&&o.a.createElement(vt,{key:"regionTags"},o.a.createElement(Ht,{regions:t,projectRegionBox:we,mouseEvents:Ee,regionClsList:j,regionTagList:I,onBeginRegionEdit:R,onChangeRegion:L,onCloseRegionEdit:P,onDeleteRegion:H,layoutParams:K,imageSrc:a,RegionEditLabel:C})),y&&null!==Be&&o.a.createElement("div",{key:"zoomBox",style:{position:"absolute",zIndex:1,border:"1px solid #fff",pointerEvents:"none",left:Be.x,top:Be.y,width:Be.w,height:Be.h}}),_&&o.a.createElement(zt,{key:"pointDistances",regions:t,realSize:c,projectRegionBox:we,pointDistancePrecision:x}),o.a.createElement(vt,Object.assign({style:{width:"100%",height:"100%"}},Ee),o.a.createElement(o.a.Fragment,null,o.a.createElement("canvas",{className:U.canvas,ref:Y}),o.a.createElement(Zt,{videoPlaying:A,imagePosition:Ge,mouseEvents:Ee,onLoad:Te,videoTime:i,videoSrc:r,imageSrc:a,onChangeVideoTime:V,onChangeVideoPlaying:F}))),o.a.createElement("div",{className:U.zoomIndicator},(1/fe.a*100).toFixed(0),"%"))},na=Object(ce.a)(b.a)({width:80,margin:2}),oa=Object(ce.a)("div")({fontWeight:"bold"}),ra=Object(n.createContext)(),ia=Object(n.memo)(function(e){var t=e.name,a=e.disabled,n=e.Icon,r=e.onClick;return o.a.createElement(na,{disabled:a,onClick:r},o.a.createElement("div",null,o.a.createElement(n,null),o.a.createElement(oa,null,t)))},function(e,t){return e.name===t.name&&e.disabled===t.disabled}),ca=function(e){var t=e.name,a=e.disabled,r=e.Icon,i=Object(n.useContext)(ra).onHeaderButtonClick,c=Object(ae.a)(function(){return i(t)});return o.a.createElement(ia,{name:t,disabled:a,Icon:r,onClick:c})},la=a(148),sa=a.n(la),ua=a(149),ma=a.n(ua),da=a(246),ga=a.n(da),ha=a(247),fa=a.n(ha),pa=a(249),ba=a.n(pa),va=a(173),ya=a.n(va),Ea=a(245),Oa=a.n(Ea),wa=a(248),xa=a.n(wa),ja={header:{display:"flex",position:"relative",flexDirection:"row",flexShrink:0,zIndex:10,boxShadow:"0px 3px 8px rgba(0,0,0,.1)"},fileInfo:{alignItems:"center",flexGrow:1,"&.videoMode":{flexMode:.1},display:"flex",fontWeight:"bold",color:Q.a[800],marginRight:16,fontSize:24,paddingLeft:16}},Ia=a(171),Sa=a.n(Ia),_a=a(110),Ta=a(244);function Na(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return Ca(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Ca(e,t)}(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,r=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){i=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(i)throw o}}}}function Ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var ka=Object(ce.a)("div")({position:"relative",display:"flex",flexGrow:1,minWidth:240,marginLeft:16,marginRight:16}),Aa=Object(ce.a)("div")({position:"absolute",width:2,marginLeft:-1,height:"100%",backgroundColor:Q.a[300],bottom:0}),Ma=Object(ce.a)("div")({position:"absolute",userSelect:"none",fontSize:10,color:Q.a[600],fontWeight:"bold",bottom:0}),La=Object(ce.a)("div")({position:"absolute",bottom:"calc(50% + 6px)",fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:48,marginLeft:-24,borderRadius:2,height:24,backgroundColor:De.a[500],userSelect:"none",fontVariantNumeric:"tabular-nums","&::before":{position:"absolute",bottom:-6,left:16,content:'""',width:0,height:0,borderTop:"8px solid ".concat(De.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}}),Ra=Object(ce.a)("div")((ea={position:"absolute",bottom:8,cursor:"pointer",opacity:.75,fontSize:10,fontWeight:"bold",color:"#fff",display:"grid",placeItems:"center",width:16,marginLeft:0,borderTopLeftRadius:2,borderTopRightRadius:2,height:12},Object(P.a)(ea,"marginLeft",-8),Object(P.a)(ea,"backgroundColor",_a.a[500]),Object(P.a)(ea,"userSelect","none"),Object(P.a)(ea,"fontVariantNumeric","tabular-nums"),Object(P.a)(ea,"&::before",{position:"absolute",bottom:-8,left:0,content:'""',width:0,height:0,borderTop:"8px solid ".concat(_a.a[500]),borderLeft:"8px solid transparent",borderRight:"8px solid transparent"}),ea)),Pa=[[50,250],[100,500],[250,1e3],[1e3,5e3],[5e3,3e4],[1e4,6e4],[3e4,12e4],[6e4,3e5],[3e5,18e5],[6e5,36e5],[18e5,108e5],[36e5,18e6]],Da=function(e){var t=e.currentTime,a=void 0===t?0:t,r=e.duration,i=e.onChangeCurrentTime,c=e.keyframes,l=Object(Ta.a)(),s=Object(p.a)(l,2),u=s[0],m=s[1],d=Object(n.useState)(a),g=Object(p.a)(d,2),h=g[0],f=g[1],b=Object(Rt.a)(!1),v=Object(p.a)(b,2),y=v[0],E=v[1],O=Object.keys(c||{}).map(function(e){return parseInt(e)}).filter(function(e){return!isNaN(e)}).sort(function(e,t){return e-t});Object(n.useEffect)(function(){a!==h&&f(a)},[a]);var w=Object(n.useMemo)(function(){return function(e){var t,a=Na(Pa);try{for(a.s();!(t=a.n()).done;){var n=t.value,o=Object(p.a)(n,2),r=o[0],i=o[1];if(e/i<6&&e/i>2)return[r,i]}}catch(c){a.e(c)}finally{a.f()}return[e/4,e]}(r)},[r]),x=Object(p.a)(w,2),j=x[0],I=x[1],S=Object(ae.a)(function(e){if(y){var t=(e.clientX-m.left)/m.width;f(Math.min(r,Math.max(0,Math.floor(t*r))))}}),_=Object(ae.a)(function(e){E(!1);var t=(e.clientX-m.left)/m.width,a=Math.min(r,Math.max(0,Math.floor(t*r)));f(a),i(a)});return r?o.a.createElement(ka,{onMouseMove:S,onMouseUp:_,ref:u},Sa()(0,r,I).map(function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Aa,{key:e,style:{left:e/r*m.width,height:"50%"}}),o.a.createElement(Ma,{style:{left:e/r*m.width+8,bottom:"calc(50% - 12px)"}},dt(e)))}),Sa()(0,r,j).filter(function(e){return!Number.isInteger(e/I)}).map(function(e){return o.a.createElement(Aa,{key:e,style:{left:e/r*m.width,height:"25%"}})}),O.map(function(e){return o.a.createElement(Ra,{onClick:function(){return i(e)},key:e,style:{left:e/r*m.width}})}),o.a.createElement(La,{onMouseDown:function(e){return E(!0)},style:{cursor:y?"grabbing":"grab",left:h/r*m.width}},dt(h))):null},Wa=a(250),Ba=a.n(Wa),Ga=Object(I.a)(ja),za=function(e){var t=e.state,a=e.onHeaderButtonClick,n=e.title,r=e.inFullScreen,i=e.videoMode,c=(e.isAVideoFrame,e.nextVideoFrameHasRegions),l=void 0!==c&&c,s=e.videoDuration,u=e.currentVideoTime,m=e.multipleImages,d=e.videoPlaying,g=e.onChangeCurrentTime,h=e.keyframes,f=e.alwaysShowPrevButton,p=e.alwaysShowNextButton,b=Ga();return o.a.createElement("div",{className:b.header},o.a.createElement("div",{className:te()(b.fileInfo,i&&"videoMode")},n),o.a.createElement("div",{className:te()(b.fileInfo,i&&"videoMode")},"Mode: ","object_detection"===t.annotatemode?"Object Detection":"Segmentation"),i&&o.a.createElement(Da,{key:"keyframeTimeline",currentTime:u,duration:s,onChangeCurrentTime:g,keyframes:h}),o.a.createElement("div",{className:b.headerActions},o.a.createElement(ra.Provider,{value:{onHeaderButtonClick:a}},(m||f)&&o.a.createElement(ca,{name:"Prev",Icon:sa.a}),(m||p)&&o.a.createElement(o.a.Fragment,null,o.a.createElement(ca,{name:"Next",Icon:ma.a}),o.a.createElement(ca,{name:"Clone",disabled:l,Icon:Oa.a})),i&&o.a.createElement(o.a.Fragment,null,d?o.a.createElement(ca,{key:"pause",name:"Pause",Icon:fa.a}):o.a.createElement(ca,{key:"play",name:"Play",Icon:ga.a})),o.a.createElement(ca,{name:"object_detection"===t.annotatemode?"SEGMENTATION":"OBJECT DETECTION",Icon:xa.a}),t.curr_image_index>0&&o.a.createElement(ca,{name:"prev image",Icon:sa.a}),o.a.createElement(ca,{name:"next image",Icon:ma.a}),o.a.createElement(ca,{name:"Settings",Icon:ba.a}),r?o.a.createElement(ca,{name:"Window",Icon:ya.a}):o.a.createElement(ca,{name:"Fullscreen",Icon:ya.a}),o.a.createElement(ca,{name:"Review",Icon:Ba.a}))))},Ha=a(80),Va=a(81),Fa=a(565),Ua=Object(n.createContext)(),Ya=Object(n.memo)(function(e){var t=e.id,a=e.name,r=e.icon,i=e.selected,c=e.togglable,l=e.alwaysShowing,s=void 0!==l&&l,u=Object(n.useContext)(Ua),m=u.enabledTools,d=u.selectedTool,g=u.onClickTool;return m.includes(t)||s?(i=i||d===t,o.a.createElement(Fa.a,{placement:"right",title:a},o.a.createElement("div",null,o.a.createElement(Z.a,{disabled:c?void 0:i,"aria-label":a,onClick:function(){return g(t)},size:"small",style:{width:50,height:50,margin:1,color:i?De.a[500]:void 0}},r)))):null},function(e,t){return e.togglable===t.togglable&&e.selected===t.selected&&e.name===t.name&&e.id===t.id}),Ja=Object(I.a)({iconTools:{display:"flex",padding:4,flexDirection:"column",zIndex:9,boxShadow:"0px 0px 5px rgba(0,0,0,0.1)",borderRight:"1px solid ".concat(Q.a[300]),backgroundColor:Q.a[100]}}),qa=["select","create-point","create-box","create-polygon"],Ka=function(e){var t=e.showTags,a=e.selectedTool,r=e.onClickTool,i=e.enabledTools,c=void 0===i?qa:i,l=Ja(),s=Object(n.useMemo)(function(){return{enabledTools:c,selectedTool:a,onClickTool:r}},[c,a]);return o.a.createElement("div",{className:l.iconTools},o.a.createElement(Ua.Provider,{value:s},o.a.createElement(Ya,{id:"select",name:"Select Region",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.d})}),o.a.createElement(Ya,{alwaysShowing:!0,id:"pan",name:"Drag/Pan",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.c})}),o.a.createElement(Ya,{alwaysShowing:!0,id:"zoom",name:"Zoom In/Out",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.f})}),o.a.createElement(Ya,{alwaysShowing:!0,togglable:!0,id:"show-tags",selected:t,name:"Show Tags",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.g})}),o.a.createElement(Ya,{id:"create-point",name:"Add Point",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.a})}),o.a.createElement(Ya,{id:"create-box",name:"Add Bounding Box",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.h})}),o.a.createElement(Ya,{id:"create-polygon",name:"Add Polygon",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.b})}),o.a.createElement(Ya,{id:"create-pixel",name:"Add Pixel Region",icon:o.a.createElement(Ha.a,{size:"xs",fixedWidth:!0,icon:Va.e})})))},Xa={container:{display:"flex",flexGrow:1,flexDirection:"column",height:"100%",maxHeight:"100vh",backgroundColor:"#fff",overflow:"hidden","&.fullscreen":{position:"absolute",zIndex:99999,left:0,right:0,top:0,bottom:0}},workspace:{backgroundColor:Q.a[200],flexGrow:1,display:"flex",flexDirection:"row",height:"100%",overflow:"hidden"},iconToolsContainer:{display:"flex"},imageCanvasContainer:{display:"flex",flexGrow:1,alignItems:"center",justifyContent:"center"},noImageSelected:{fontWeight:"bold",fontSize:32,color:Q.a[500]},sidebarContainer:{width:300,flexShrink:0,overflowY:"auto",backgroundColor:Q.a[100],borderLeft:"1px solid ".concat(Q.a[300]),zIndex:9,height:"100%",boxShadow:"0px 0px 5px rgba(0,0,0,0.1)"}},Za=a(252),$a=a.n(Za),Qa=a(563),en=a(556),tn=a(557),an=a(558),nn=a(253),on=a.n(nn),rn=function(e){var t=e.open,a=e.onClose,n=Jt();return o.a.createElement(Qa.a,{open:t||!1,onClose:a},o.a.createElement(en.a,null,"Settings"),o.a.createElement(tn.a,{style:{minWidth:400}},o.a.createElement(on.a,{variant:"flat",noActions:!0,defaultAnswers:n,onQuestionChange:function(e,t,a){return n.changeSetting(e,t)},form:{questions:[{type:"boolean",title:"Show Crosshairs",name:"showCrosshairs"},{type:"dropdown",title:"Video Playback Speed",name:"videoPlaybackSpeed",defaultValue:".25x",choices:["0.25x","0.5x","1x","2x"]}]}})),o.a.createElement(an.a,null,o.a.createElement(b.a,{onClick:a},"Close")))},cn=a(258),ln=a.n(cn),sn=function(e){return e.enabled?o.a.createElement(ln.a,e,e.children):e.children},un=function(e){var t,a,n=null;return"image"===e.annotationType?-1===(n=e.images.findIndex(function(t){return t.src===e.selectedImage&&(void 0===e.selectedImageFrameTime||t.frameTime===e.selectedImageFrameTime)}))?(n=null,a=null):(t=["images",n],a=Object(it.getIn)(e,t)):"video"===e.annotationType&&(t=["keyframes",e.currentVideoTime||0],a=Object(it.getIn)(e,t)||null),{currentImageIndex:n,pathToActiveImage:t,activeImage:a}};function mn(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return dn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dn(e,t)}(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,r=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){i=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(i)throw o}}}}function dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var gn=[],hn=function(e,t){if(e[t||0])return e[t||0].regions;var a=Object.keys(e).map(function(e){return parseInt(e)}).filter(function(e){return!isNaN(e)});if(0===a.length)return gn;a.sort(function(e,t){return e-t});var n=a.findIndex(function(e){return e>=t});if(-1===n)return e[a[a.length-1]].regions||gn;if(0===n)return gn;var o,r=a[n-1],i=e[r],c=a[n],l=e[c],s={},u={},m=mn(i.regions);try{for(m.s();!(o=m.n()).done;){var d=o.value;s[d.id]=d}}catch(O){m.e(O)}finally{m.f()}var g,h=mn(l.regions);try{for(h.s();!(g=h.n()).done;){var f=g.value;u[f.id]=f}}catch(O){h.e(O)}finally{h.f()}var p=[],b=(c-t)/(c-r),v=1-b,y=function(e){var t=[s[e],u[e]],a=t[0],n=t[1];if(!n)return p.push(Object(q.a)({},a,{highlighted:!1,editingLabels:!1})),"continue";switch(a.type){case"point":p.push(Object(q.a)({},a,{highlighted:!1,editingLabels:!1,x:a.x*b+n.x*v,y:a.y*b+n.y*v}));break;case"box":p.push(Object(q.a)({},a,{highlighted:!1,editingLabels:!1,x:a.x*b+n.x*v,y:a.y*b+n.y*v,w:a.w*b+n.w*v,h:a.h*b+n.h*v}));break;case"polygon":n.points.length===a.points.length?p.push(Object(q.a)({},a,{highlighted:!1,editingLabels:!1,points:a.points.map(function(e,t){return[e[0]*b+n.points[t][0]*v,e[1]*b+n.points[t][1]*v]})})):p.push(a)}};for(var E in s)y(E);return p},fn=[],pn=Object(I.a)(Xa),bn=function(e){var t,a=e.state,r=e.dispatch,i=(e.alwaysShowNextButton,e.alwaysShowPrevButton,e.RegionEditLabel),c=pn(),l=Jt(),s=Object(n.useRef)({}),u=function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];var o="".concat(e,"(").concat(a.join(","),")");if(s.current[o])return s.current[o];var i=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return a.length>0?r(Object(q.a)({type:e},a.reduce(function(e,t,a){return e[t]=n[a],e},{}))):r(Object(q.a)({type:e},n[0]))};return s.current[o]=i,i},m=un(a),d=m.currentImageIndex,g=m.activeImage;null!==d&&(t=a.images[d+1]),$a()(function(){return r({type:"CANCEL"})},{detectKeys:[27]});var h=g&&void 0!==g.frameTime,f=function(e){if("video"!==e.annotationType)return fn;var t=e.keyframes,a=e.currentVideoTime,o=void 0===a?0:a;return Object(n.useMemo)(function(){return hn(t,o)},[t,o])}(a);return o.a.createElement(sn,{enabled:a.fullScreen,onChange:function(e){e||u("HEADER_BUTTON_CLICKED","buttonName")("Exit Fullscreen")}},o.a.createElement("div",{className:te()(c.container,a.fullScreen&&"Fullscreen")},o.a.createElement("div",{className:c.headerContainer},o.a.createElement(za,{state:a,onHeaderButtonClick:u("HEADER_BUTTON_CLICKED","buttonName"),videoMode:"video"===a.annotationType,inFullScreen:a.fullScreen,isAVideoFrame:h,nextVideoFrameHasRegions:!t||t.regions&&t.regions.length>0,videoDuration:a.videoDuration,multipleImages:a.images&&a.images.length>1,title:"image"===a.annotationType?g?g.name:"No Image Selected":a.videoName||"",onChangeCurrentTime:u("CHANGE_VIDEO_TIME","newTime"),videoPlaying:a.videoPlaying,currentVideoTime:a.currentVideoTime,keyframes:a.keyframes})),o.a.createElement("div",{className:c.workspace},o.a.createElement("div",{className:c.iconToolsContainer},o.a.createElement(Ka,{enabledTools:a.enabledTools,showTags:a.showTags,selectedTool:a.selectedTool,onClickTool:u("SELECT_TOOL","selectedTool")})),o.a.createElement("div",{className:c.imageCanvasContainer},"image"!==a.annotationType||a.selectedImage?o.a.createElement("div",{style:{height:"100%",width:"100%"}},o.a.createElement(aa,Object.assign({},l,{key:a.selectedImage,showTags:a.showTags,allowedArea:a.allowedArea,regionClsList:a.regionClsList,regionTagList:a.regionTagList,regions:"image"===a.annotationType?g.regions||[]:f,realSize:g?g.realSize:void 0,videoPlaying:a.videoPlaying,imageSrc:"image"===a.annotationType?a.selectedImage:null,videoSrc:"video"===a.annotationType?a.videoSrc:null,pointDistancePrecision:a.pointDistancePrecision,createWithPrimary:a.selectedTool.includes("create"),dragWithPrimary:"pan"===a.selectedTool,zoomWithPrimary:"zoom"===a.selectedTool,showPointDistances:a.showPointDistances,videoTime:"image"===a.annotationType?a.selectedImageFrameTime:a.currentVideoTime,onMouseMove:u("MOUSE_MOVE"),onMouseDown:u("MOUSE_DOWN"),onMouseUp:u("MOUSE_UP"),onChangeRegion:u("CHANGE_REGION","region"),onBeginRegionEdit:u("OPEN_REGION_EDITOR","region"),onCloseRegionEdit:u("CLOSE_REGION_EDITOR","region"),onDeleteRegion:u("DELETE_REGION","region"),onBeginBoxTransform:u("BEGIN_BOX_TRANSFORM","box","directions"),onBeginMovePolygonPoint:u("BEGIN_MOVE_POLYGON_POINT","polygon","pointIndex"),onAddPolygonPoint:u("ADD_POLYGON_POINT","polygon","point","pointIndex"),onSelectRegion:u("SELECT_REGION","region"),onBeginMovePoint:u("BEGIN_MOVE_POINT","point"),onImageLoaded:u("IMAGE_LOADED","image"),RegionEditLabel:i,onImageOrVideoLoaded:u("IMAGE_OR_VIDEO_LOADED","metadata"),onChangeVideoTime:u("CHANGE_VIDEO_TIME","newTime"),onChangeVideoPlaying:u("CHANGE_VIDEO_PLAYING","isPlaying")}))):o.a.createElement("div",{className:c.noImageSelected},"No Image Selected")),o.a.createElement("div",{className:c.sidebarContainer},o.a.createElement(It,{metadata:a.metadata,allowed_metadata:a.allowed_metadata,preview:a.preview,previewList:a.previewList,debug:window.localStorage.$ANNOTATE_DEBUG_MODE&&a,taskDescription:a.taskDescription,images:a.images,regions:g?g.regions:null,history:a.history,currentImage:g,labelImages:a.labelImages,imageClsList:a.imageClsList,imageTagList:a.imageTagList,keyframes:a.keyframes,currentVideoTime:a.currentVideoTime,onChangeMetadata:u("CHANGE_METADATA","metadata"),onChangeImage:u("CHANGE_IMAGE","delta"),onSelectRegion:u("SELECT_REGION","region"),onDeleteRegion:u("DELETE_REGION","region"),onSelectImage:u("SELECT_IMAGE","image"),onChangeRegion:u("CHANGE_REGION","region"),onRestoreHistory:u("RESTORE_HISTORY"),onChangeVideoTime:u("CHANGE_VIDEO_TIME","newTime"),onDeleteKeyframe:u("DELETE_KEYFRAME","time"),onShortcutActionDispatched:r}))),o.a.createElement(rn,{open:a.settingsOpen,onClose:function(){return r({type:"HEADER_BUTTON_CLICKED",buttonName:"Settings"})}})))};function vn(e){if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"===typeof e)return yn(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yn(e,t)}(e))){var t=0,a=function(){};return{s:a,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,r=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){i=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(i)throw o}}}}function yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var En={BEGIN_BOX_TRANSFORM:"Transform/Move Box",BEGIN_MOVE_POINT:"Move Point",DELETE_REGION:"Delete Region"},On=function(e,t){return Object(it.updateIn)(e,["history"],function(a){return[{time:Qe()().toDate(),state:Object(it.without)(e,"history"),name:t}].concat((a||[]).slice(0,9))})},wn=function(){return Math.random().toString().split(".")[1]},xn=function(){var e,t,a=(e=0,t=360,Math.floor(Math.random()*(t-e+1))+e);return"hsl(".concat(a,",").concat(100,"%,").concat(50,"%)")},jn=function(e,t){if("MOUSE_MOVE"===t.type){if(Date.now()-(e.lastMouseMoveCall||0)<16)return e;e=Object(it.setIn)(e,["lastMouseMoveCall"],Date.now())}t.type.includes("MOUSE")||(e=Object(it.setIn)(e,["lastAction"],t));var a=un(e),n=a.currentImageIndex,o=a.pathToActiveImage,r=a.activeImage,i=function(e){var t="string"===typeof e?e:e.id;if(!r)return null;var a=(r.regions||[]).findIndex(function(e){return e.id===t});return-1===a?null:a},c=function(e){if(!r)return null;var t=i(e);return null===t?[null,null]:[r.regions[t],t]},l=function(t,a){var n=c(t),i=Object(p.a)(n,2),l=i[0],s=i[1];if(!l)return e;if(null!==a)return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",s]),Object(q.a)({},l,a));var u=r.regions;return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),(u||[]).filter(function(e){return e.id!==l.id}))},s=function(e){return r?Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),(r.regions||[]).map(function(e){return Object(q.a)({},e,{highlighted:!1})})):e},u=function(e){return null===n?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),(r.regions||[]).map(function(e){return Object(q.a)({},e,{editingLabels:!1})}))},m=function(t){var a="object"===typeof t?t:{src:t},n=a.src,o=a.frameTime;return Object(it.setIn)(Object(it.setIn)(e,["selectedImage"],n),["selectedImageFrameTime"],o)};switch(t.type){case"@@INIT":return e;case"SELECT_IMAGE":return m(t.image);case"CHANGE_REGION":var d=i(t.region);if(null===d)return e;var g=r.regions[d];return g.cls!==t.region.cls&&(e=On(e,"Change Region Classification")),be()(g.tags,t.region.tags)||(e=On(e,"Change Region Tags")),Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",d]),t.region);case"CHANGE_IMAGE":if(!r)return e;for(var h=t.delta,f=0,b=Object.keys(h);f<b.length;f++){var v=b[f];"cls"===v&&On(e,"Change Image Class"),"tags"===v&&On(e,"Change Image Tags"),e=Object(it.setIn)(e,[].concat(Object(J.a)(o),[v]),h[v])}return e;case"SELECT_REGION":var y=t.region;if(null===i(t.region))return e;var E=Object(J.a)(r.regions||[]).map(function(e){return Object(q.a)({},e,{highlighted:e.id===y.id,editingLabels:e.id===y.id})});return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),E);case"BEGIN_MOVE_POINT":return e=u(e),Object(it.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:t.point.id});case"BEGIN_BOX_TRANSFORM":var O=t.box,w=t.directions;return e=u(e),0===w[0]&&0===w[1]?Object(it.setIn)(e,["mode"],{mode:"MOVE_REGION",regionId:O.id}):Object(it.setIn)(e,["mode"],{mode:"RESIZE_BOX",regionId:O.id,freedom:w,original:{x:O.x,y:O.y,w:O.w,h:O.h}});case"BEGIN_MOVE_POLYGON_POINT":var x=t.polygon,j=t.pointIndex;return(e=u(e)).mode&&"DRAW_POLYGON"===e.mode.mode&&0===j?Object(it.setIn)(l(x,{points:x.points.slice(0,-1),open:!1}),["mode"],null):(e=On(e,"Move Polygon Point"),Object(it.setIn)(e,["mode"],{mode:"MOVE_POLYGON_POINT",regionId:x.id,pointIndex:j}));case"ADD_POLYGON_POINT":var I=t.polygon,S=t.point,_=t.pointIndex,T=i(I);if(null===T)return e;var N=Object(J.a)(I.points);return N.splice(_,0,S),Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",T]),Object(q.a)({},I,{points:N}));case"MOUSE_MOVE":var C=t.x,k=t.y;if(!e.mode)return e;if(!r)return e;switch(e.mode.mode){case"MOVE_POLYGON_POINT":var A=e.mode,M=A.pointIndex,L=A.regionId,R=i(L);return null===R?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",R,"points",M]),[C,k]);case"MOVE_REGION":var P=e.mode.regionId,D=i(P);return null===D?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",D]),function(e,t,a){switch(e.type){case"point":return Object(q.a)({},e,{x:t,y:a});case"box":return Object(q.a)({},e,{x:t-e.w/2,y:a-e.h/2})}return e}(r.regions[D],C,k));case"RESIZE_BOX":var W=e.mode,B=W.regionId,G=Object(p.a)(W.freedom,2),z=G[0],H=G[1],V=W.original,F=V.x,U=V.y,Y=V.w,K=V.h,X=i(B);if(null===X)return e;var Z=r.regions[X],$=0===z?F:-1===z?Math.min(F+Y,C):F,Q=0===z?Y:-1===z?Y+(F-$):Math.max(0,Y+(C-F-Y)),ee=0===H?U:-1===H?Math.min(U+K,k):U,te=0===H?K:-1===H?K+(U-ee):Math.max(0,K+(k-U-K));return Q<=.001&&(e=Object(it.setIn)(e,["mode","freedom"],[-1*z,H])),te<=.001&&(e=Object(it.setIn)(e,["mode","freedom"],[z,-1*H])),Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",X]),Object(q.a)({},Z,{x:$,w:Q,y:ee,h:te}));case"DRAW_POLYGON":var ae=e.mode.regionId,ne=c(ae),oe=Object(p.a)(ne,2),re=oe[0],ie=oe[1];return re?Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",ie,"points",re.points.length-1]),[C,k]):Object(it.setIn)(e,["mode"],null)}return e;case"MOUSE_DOWN":if(!r)return e;var ce,le=t.x,se=t.y;if(e.allowedArea){var ue=e.allowedArea;if(le<ue.x||le>ue.x+ue.w||se<ue.y||se>ue.y+ue.h)return e}switch(e.selectedTool){case"create-point":e=On(e,"Create Point"),ce={type:"point",x:le,y:se,highlighted:!0,editingLabels:!0,color:xn(),id:wn()};break;case"create-box":e=On(e,"Create Box"),ce={type:"box",x:le,y:se,w:.01,h:.01,highlighted:!0,editingLabels:!1,color:xn(),id:wn()},e=s(e),e=Object(it.setIn)(e,["mode"],{mode:"RESIZE_BOX",editLabelEditorAfter:!0,regionId:ce.id,freedom:[1,1],original:{x:le,y:se,w:ce.w,h:ce.h},isNew:!0});break;case"create-polygon":if(e.mode&&"DRAW_POLYGON"===e.mode.mode)break;e=On(e,"Create Polygon"),ce={type:"polygon",points:[[le,se],[le,se]],open:!0,highlighted:!0,color:xn(),id:wn()},e=Object(it.setIn)(e,["mode"],{mode:"DRAW_POLYGON",regionId:ce.id})}if(ce&&(e=s(e)),e.mode)switch(e.mode.mode){case"DRAW_POLYGON":var me=c(e.mode.regionId),de=Object(p.a)(me,2),ge=de[0],he=de[1];if(!ge)break;return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",he]),Object(q.a)({},ge,{points:ge.points.concat([[le,se]])}))}var fe=Object(J.a)(r.regions||[]).map(function(e){return Object(q.a)({},e,{editingLabels:!1})}).concat(ce?[ce]:[]);return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),fe);case"MOUSE_UP":var pe=t.x,ve=t.y;if(!e.mode)return e;switch(e.mode.mode){case"RESIZE_BOX":if(e.mode.isNew&&Math.abs(e.mode.original.x-pe)<.01&&Math.abs(e.mode.original.y-ve)<.01)return Object(it.setIn)(l(e.mode.regionId,null),["mode"],null);if(e.mode.editLabelEditorAfter)return Object(q.a)({},l(e.mode.regionId,{editingLabels:!0}),{mode:null});case"MOVE_REGION":case"MOVE_POLYGON_POINT":return Object(q.a)({},e,{mode:null})}return e;case"CHANGE_REGION":var ye=t.region,Ee=i(t.region);return null===Ee?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",Ee]),ye);case"OPEN_REGION_EDITOR":t.region;var Oe=i(t.region);if(null===Oe)return e;var we=Object(it.setIn)(r.regions.map(function(e){return Object(q.a)({},e,{highlighted:!1,editingLabels:!1})}),[Oe],Object(q.a)({},(r.regions||[])[Oe],{highlighted:!0,editingLabels:!0}));return Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),we);case"CLOSE_REGION_EDITOR":t.region;var xe=i(t.region);return null===xe?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions",xe]),Object(q.a)({},(r.regions||[])[xe],{editingLabels:!1}));case"DELETE_REGION":return null===i(t.region)?e:Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),(r.regions||[]).filter(function(e){return e.id!==t.region.id}));case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"prev":return null===n?e:0===n?e:m(e.images[n-1]);case"next":return null===n?e:n===e.images.length-1?e:m(e.images[n+1]);case"clone":return null===n?e:n===e.images.length-1?e:Object(it.setIn)(m(e.images[n+1]),["images",n+1,"regions"],r.regions);case"settings":return Object(it.setIn)(e,["settingsOpen"],!e.settingsOpen);case"fullscreen":return Object(it.setIn)(e,["fullScreen"],!0);case"exit fullscreen":case"window":return Object(it.setIn)(e,["fullScreen"],!1);case"hotkeys":return e;case"exit":case"done":case"next image":case"prev image":return e;case"object detection":return Object(it.setIn)(e,["annotatemode"],"object_detection");case"segmentation":return Object(it.setIn)(e,["annotatemode"],"segmentation")}return e;case"SELECT_TOOL":return e=Object(it.setIn)(e,["mode"],null),"show-tags"===t.selectedTool?Object(it.setIn)(e,["showTags"],!e.showTags):(console.log("[selectedtool]",e.selectedTool),Object(it.setIn)(e,["selectedTool"],t.selectedTool));case"CANCEL":var je=e.mode;if(je)switch(je.mode){case"DRAW_POLYGON":return l(je.regionId,null);case"MOVE_POLYGON_POINT":case"RESIZE_BOX":case"MOVE_REGION":return Object(it.setIn)(e,["mode"],null)}var Ie=r.regions;return Ie.some(function(e){return e.editingLabels})?Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),Ie.map(function(e){return Object(q.a)({},e,{editingLabels:!1})})):Object(it.setIn)(e,[].concat(Object(J.a)(o),["regions"]),Ie.map(function(e){return Object(q.a)({},e,{highlighted:!1})}));case"RELOAD":return Object(it.setIn)(e,["images"],t.image);case"ANNOTATION_MODE":return"segmentation"===e.annotatemode?(console.log("[reducer annotatemode]",e.annotatemode),Object(it.setIn)(e,["enabledTools"],["select","create-polygon"])):(console.log("[reducer annotatemode]",e.annotatemode),Object(it.setIn)(e,["enabledTools"],["select","create-box"]));case"CLASS_LIST":return Object(it.setIn)(e,["regionClsList"],t.classlist);case"IMAGE_INDEX":return Object(it.setIn)(e,["curr_image_index"],t.curr_image_index);case"CHANGE_METADATA":return Object(it.setIn)(e,["metadata"],t.metadata);case"CHANGE_METALIST":return Object(it.setIn)(e,["allowed_metadata"],t.metadata);case"PREVIEW_LIST":return Object(it.setIn)(e,["previewList"],t.image);case"LOADER":return Object(it.setIn)(e,["loader"],t.value);case"LOADER_MESSAGE":return Object(it.setIn)(e,["message"],t.value)}return e},In=function(e,t){var a=un(e),n=a.currentImageIndex;a.pathToActiveImage,a.activeImage;switch(t.type){case"IMAGE_LOADED":return console.log("[Image_loaded]",e),Object(it.setIn)(e,["images",n,"pixelSize"],{w:t.image.width,h:t.image.height})}return e},Sn=function(e,t){var a=function(){return Object(it.setIn)(On(e,"Add Keyframe"),["keyframes",e.currentVideoTime],{regions:hn(e.keyframes,e.currentVideoTime)})};switch(t.type){case"IMAGE_OR_VIDEO_LOADED":var n=t.metadata.duration;if("number"===typeof n)return Object(it.setIn)(e,["videoDuration"],1e3*n);case"HEADER_BUTTON_CLICKED":switch(t.buttonName.toLowerCase()){case"play":return Object(it.setIn)(e,["videoPlaying"],!0);case"pause":return Object(it.setIn)(e,["videoPlaying"],!1)}case"CHANGE_VIDEO_TIME":return Object(it.setIn)(e,["currentVideoTime"],t.newTime);case"CHANGE_VIDEO_PLAYING":return Object(it.setIn)(e,["videoPlaying"],t.isPlaying);case"DELETE_KEYFRAME":return Object(it.setIn)(e,["keyframes"],Object(it.without)(e.keyframes,t.time))}if(!e.keyframes[e.currentVideoTime])switch(t.type){case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POINT":case"BEGIN_MOVE_POLYGON_POINT":case"BEGIN_BOX_TRANSFORM":case"BEGIN_MOVE_POLYGON_POINT":case"ADD_POLYGON_POINT":case"SELECT_REGION":case"CHANGE_REGION":case"DELETE_REGION":case"OPEN_REGION_EDITOR":return a();case"MOUSE_DOWN":switch(e.selectedTool){case"create-point":case"create-polygon":case"create-box":return a()}}return e},_n=function(e){var t=e.images,a=e.allowedArea,r=e.selectedImage,i=void 0===r?t&&t.length>0?t[0].src:void 0:r,c=e.showPointDistances,l=e.pointDistancePrecision,s=e.showTags,u=void 0===s||s,m=e.enabledTools,d=void 0===m?["select","create-point","create-box"]:m,g=e.regionTagList,h=void 0===g?[]:g,f=e.regionClsList,b=void 0===f?[]:f,v=e.imageTagList,y=void 0===v?[]:v,E=e.imageClsList,O=void 0===E?[]:E,w=e.keyframes,x=void 0===w?{}:w,j=e.taskDescription,I=e.RegionEditLabel,S=e.videoSrc,_=e.videoTime,T=void 0===_?0:_,N=e.videoName,k=e.onExit,A=e.onNextImage,M=e.onPrevImage,L=e.preview,R=e.previewList,P=e.curr_image_index,D=e.changeAnnotateMode,W=e.annotatemode,B=e.allowed_metadata,G=e.metadata,z=void 0===G?{}:G,H=e.loading,V=e.message,F=e.updateRegion;Jt();if(!t&&!S)return'Missing required prop "images" or "videoSrc"';var U,Y=t?"image":"video",J=Object(n.useReducer)((U=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e,a){var n,o=vn(t);try{for(o.s();!(n=o.n()).done;)e=(0,n.value)(e,a)}catch(r){o.e(r)}finally{o.f()}return e}}("image"===Y?In:Sn,jn),function(e,t){var a=e,n=U(e,t);if("RESTORE_HISTORY"===t.type){if(e.history.length>0)return Object(it.setIn)(n.history[0].state,["history"],n.history.slice(1))}else if(a!==n&&Object.keys(En).includes(t.type))return Object(it.setIn)(n,["history"],[{time:Qe()().toDate(),state:Object(it.without)(a,"history"),name:En[t.type]||t.type}].concat(n.history||[]).slice(0,9));return n}),ct()(Object(q.a)({message:V,updateRegion:F,loading:H,metadata:z,allowed_metadata:B,annotationType:Y,curr_image_index:P,preview:L,previewList:R,changeAnnotateMode:D,annotatemode:W,showTags:u,allowedArea:a,showPointDistances:c,pointDistancePrecision:l,selectedTool:"select",mode:null,taskDescription:j,labelImages:O.length>0||y.length>0,regionClsList:b,regionTagList:h,imageClsList:O,imageTagList:y,currentVideoTime:T,enabledTools:d,history:[],videoName:N},"image"===Y?{selectedImage:i,images:t,selectedImageFrameTime:t&&t.length>0?t[0].frameTime:void 0}:{videoSrc:S,keyframes:x}))),K=Object(p.a)(J,2),X=K[0],Z=K[1],$=Object(ae.a)(function(e){if("HEADER_BUTTON_CLICKED"===e.type){if(["Exit","Done","Save","Complete","Review"].includes(e.buttonName))return k(Object(it.without)(X,"history"));if("next image"===e.buttonName&&A)return Z({type:"CHANGE_METADATA",metadata:null}),A(Object(it.without)(X,"history"));if("prev image"===e.buttonName&&M)return Z({type:"CHANGE_METADATA",metadata:null}),M(Object(it.without)(X,"history"))}Z(e)});return Object(n.useEffect)(function(){Z({type:"SELECT_IMAGE",image:X.images.find(function(e){return e.src===i})})},[i]),Object(n.useEffect)(function(){Z({type:"RELOAD",image:t}),Z({type:"SELECT_IMAGE",image:t[0]})},[t]),Object(n.useEffect)(function(){Z({type:"CLASS_LIST",classlist:b})},[b]),Object(n.useEffect)(function(){"object_detection"===X.annotatemode?(Z({type:"ANNOTATION_MODE"}),Z({type:"SELECT_TOOL",selectedTool:"create-box"}),X.changeAnnotateMode(X.annotatemode)):(Z({type:"ANNOTATION_MODE"}),Z({type:"SELECT_TOOL",selectedTool:"create-polygon"}),X.changeAnnotateMode(X.annotatemode))},[X.annotatemode]),Object(n.useEffect)(function(){Z({type:"IMAGE_INDEX",curr_image_index:P})},[P]),Object(n.useEffect)(function(){Z({type:"PREVIEW_LIST",image:R})},[R]),Object(n.useEffect)(function(){Z({type:"CHANGE_METADATA",metadata:z})},[z]),Object(n.useEffect)(function(){Z({type:"CHANGE_METALIST",metadata:B})},[B]),Object(n.useEffect)(function(){Z({type:"LOADER",value:H})},[H]),Object(n.useEffect)(function(){Z({type:"LOADER_MESSAGE",value:V})},[V]),H?o.a.createElement(C,{message:V}):o.a.createElement(qt,null,o.a.createElement(bn,{RegionEditLabel:I,alwaysShowNextButton:Boolean(A),alwaysShowPrevButton:Boolean(M),state:X,dispatch:$}))},Tn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={src:null,image_key:"",annotatemode:"object_detection",curr_image_index:0,call_type:"first",regions:[],metadata:"",class_list:"",seg_class:[],obj_class:[],allowed_metadata:{},dimension:{imgHeight:0,imgWidth:0},previewList:[],loading:!0,message:"Fetching Image for annotation"},a.getImageSize=function(){var e=Object(B.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return{},e.abrupt("return",new Promise(function(e,a){var n=new Image;n.src=t,n.onload=function(){return e({imgHeight:n.height,imgWidth:n.width})}}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.titleHandler=function(e){switch(e.message){case"Cannot read property 'map' of undefined":return"No segmentation data ";case"Cannot read property 'data' of undefined":return"No more images left for you";case"Cannot read property '0' of undefined":return"Image not valid";default:return e.message}},a.getRandomId=function(){return Math.random().toString().split(".")[1]},a.postImage=function(){var e=Object(B.a)(W.a.mark(function e(t,n){var o,r,i,c,l,s,u,m,d;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("next",t),o=[],l=a.state.dimension,s=l.imgWidth,u=l.imgHeight,null!=t.metadata?null!==t.images[0].regions?("object_detection"===a.state.annotatemode?t.images[0].regions.map(function(e){o.push({cls:e.cls,highlighted:!1,id:e.id,x:e.x*s,y:e.y*u,w:e.w*s,h:e.h*u,color:"hsl(82,100%,50%)",type:"box",cls_id:"".concat(a.state.class_list.indexOf(e.cls))})}):t.images[0].regions.map(function(e){var t=[];e.points.map(function(e,a){t.push([e[0]*s,e[1]*u])}),o.push({cls:e.cls,highlighted:!1,id:e.id,points:t,color:"hsl(82,100%,50%)",type:"polygon",cls_id:"".concat(a.state.class_list.indexOf(e.cls))})}),console.log("[generarted regions]",o),"review"===n&&(localStorage.getItem("checkList")?(m=JSON.parse(localStorage.getItem("checkList")),d=[].concat(Object(J.a)(m),[a.state.image_key]),localStorage.setItem("checkList",JSON.stringify(d))):localStorage.setItem("checkList",JSON.stringify([a.state.image_key]))),f.a.post("/annotations/update-get-image-data-by-user",{image_key:a.state.image_key,metadata:t.metadata,annotations:o},{headers:{Authorization:"bearer ".concat(localStorage.getItem("jwt"))},params:{annotate_mode:a.state.annotatemode,call_type:"review"===n?"next":n,curr_image_index:"previous"===n?a.state.curr_image_index-1:a.state.curr_image_index+1}}).then(function(e){i=e,localStorage.setItem("metadata",JSON.stringify(e.data.metadata)),console.log("[next api]",e),e.data.error?(a.setState({loading:!1,src:null}),A()({title:e.data.error,icon:"warning",buttons:!0})):a.toArrayBuffer(e.data.image.data).then(function(t){var o=new Blob([t],{type:"image/jpeg"});r=URL.createObjectURL(o),a.getImageSize(r).then(function(t){c=t;var o=[];e.data.annotations.obj_detect||e.data.annotations.segmentation?"object_detection"===a.state.annotatemode?e.data.annotations.obj_detect.map(function(e,n){o.push({cls:e.Class_Name,highlighted:!1,id:a.getRandomId(),x:e.Region[0]/t.imgWidth,y:e.Region[1]/t.imgHeight,w:e.Region[2]/t.imgWidth,h:e.Region[3]/t.imgHeight,color:"hsl(82,100%,50%)",type:"box"})}):e.data.annotations.segmentation.map(function(e,n){var r=[];e.Region.map(function(e,a){r.push([e[0]/t.imgWidth,e[1]/t.imgHeight])}),o.push({cls:e.Class_Name,highlighted:!1,id:a.getRandomId(),points:r,color:"hsl(82,100%,50%)",type:"polygon"})}):"object_detection"===a.state.annotatemode?e.data.annotations.map(function(e,a){o.push({cls:e.cls,highlighted:!1,id:e.id,x:e.x/t.imgWidth,y:e.y/t.imgHeight,w:e.w/t.imgWidth,h:e.h/t.imgHeight,color:"hsl(82,100%,50%)",type:"box"})}):e.data.annotations.map(function(e,a){var n=[];e.points.map(function(e,a){n.push([e[0]/t.imgWidth,[e[1]/t.imgHeight]])}),o.push({cls:e.cls,highlighted:!1,id:e.id,points:n,color:"hsl(82,100%,50%)",type:"polygon"})}),a.setState({curr_image_index:"previous"===n?a.state.curr_image_index-1:a.state.curr_image_index+1,src:r,regions:o,metadata:e.data.metadata,image_key:e.data.image_key,dimension:t,previewList:JSON.parse(localStorage.getItem("checkList"))?JSON.parse(localStorage.getItem("checkList")):[],loading:!1})}).catch(function(t){a.setState({curr_image_index:"previous"===n?a.state.curr_image_index-1:a.state.curr_image_index+1,src:r,metadata:e.data.metadata,image_key:e.data.image_key,dimension:c,regions:null,previewList:JSON.parse(localStorage.getItem("checkList"))?JSON.parse(localStorage.getItem("checkList")):[],loading:!1}),"Cannot read property 'map' of undefined"!==t.message&&A()({title:a.titleHandler(t),icon:"warning",buttons:!0})})}).catch(function(t){a.setState({curr_image_index:"previous"===n?a.state.curr_image_index-1:a.state.curr_image_index+1,src:r,metadata:e.data.metadata,image_key:e.data.image_key,dimension:c,regions:null,previewList:JSON.parse(localStorage.getItem("checkList"))?JSON.parse(localStorage.getItem("checkList")):[],loading:!1}),"Cannot read property 'map' of undefined"!==t.message&&A()({title:a.titleHandler(t),icon:"warning",buttons:!0})})}).catch(function(e){a.setState({curr_image_index:"previous"===n?a.state.curr_image_index-1:a.state.curr_image_index+1,src:r,metadata:i.data.metadata,image_key:i.data.image_key,dimension:c,regions:null,previewList:JSON.parse(localStorage.getItem("checkList"))?JSON.parse(localStorage.getItem("checkList")):[],loading:!1}),"Cannot read property 'map' of undefined"!==e.message&&A()({title:a.titleHandler(e),icon:"warning",buttons:!0})})):(console.log("exit if"),a.setState({loading:!1,metadata:JSON.parse(localStorage.getItem("metadata"))?JSON.parse(localStorage.getItem("metadata")):null}),A()({title:"Annotations  cannot be empty",icon:"warning",buttons:!0})):(console.log("[image]",t.images[0].regions,"[state]",a.state.regions),a.setState({loading:!1}),A()({title:"metadata cannot be empty",icon:"warning",buttons:!0}));case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.prevImage=function(){var e=Object(B.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("previous",t),e.prev=1,a.setState({loading:!0,message:"Fetching previous Image ",metadata:null,regions:t.images[0].regions}),e.next=5,a.postImage(t,"previous").then(function(e){console.log("[prev call]",e)}).catch(function(e){a.setState({loading:!1}),A()({title:a.titleHandler(e),icon:"warning",buttons:!0})});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),a.setState({loading:!1}),A()({title:a.titleHandler(e.t0),icon:"warning",buttons:!0});case 11:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.nextImage=function(){var e=Object(B.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a.setState({loading:!0,message:"Fetching Next Image",metadata:null}),null===a.state.src){e.next=8;break}return console.log("ended"),e.next=6,a.postImage(t,"next").then(function(e){console.log("[next call]",e)}).catch(function(e){a.setState({loading:!1}),A()({title:a.titleHandler(e),icon:"warning",buttons:!0})});case 6:e.next=10;break;case 8:a.setState({loading:!1}),A()({title:"No more images",text:"Try reload or come back later",icon:"warning",buttons:!0});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),a.setState({loading:!1}),A()({title:a.titleHandler(e.t0),icon:"warning",buttons:!0});case 16:case"end":return e.stop()}},e,null,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),a.checkImage=function(e){try{a.setState({loading:!0,message:"Marking the image for Review"}),a.postImage(e,"review").then(function(e){console.log("[review]",e)}).catch(function(e){a.setState({loading:!1}),A()({title:a.titleHandler(e),icon:"warning",buttons:!0})})}catch(t){a.setState({loading:!1}),A()({title:a.titleHandler(t),icon:"warning",buttons:!0})}},a.preview=function(e){console.log("[preview image]",e),a.setState({loading:!0,message:"Fething Image for Review"}),a.main_api("review",e)},a.changeAnnotateMode=function(e){a.setState({annotatemode:e}),"segmentation"===e?(a.setState({class_list:a.state.seg_class,curr_image_index:0,loading:!0,message:"changing into Segmentation mode"}),a.main_api("first")):(a.setState({class_list:a.state.obj_class}),"first"!=a.state.call_type&&(a.setState({loading:!0,curr_image_index:0,message:"changing into Object Detection mode"}),a.main_api("first")))},a.get_class=function(){var e=Object(B.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/get_class",{params:{project:t}}).then(function(e){console.log(e),a.setState({obj_class:e.data.classes.obj_class,seg_class:e.data.classes.seg_class,class_list:e.data.classes.obj_class,allowed_metadata:e.data.classes.meta_data})}).catch(function(e){a.setState({loading:!1}),A()({title:a.titleHandler(e),icon:"warning",buttons:!0})});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"toArrayBuffer",value:function(){var e=Object(B.a)(W.a.mark(function e(t){var a,n,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a=new ArrayBuffer(t.length),n=new Uint8Array(a),o=0;o<t.length;++o)n[o]=t[o];return e.abrupt("return",a);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"main_api",value:function(){var e=Object(B.a)(W.a.mark(function e(t,a){var n,o,r,i=this;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Mainapi"),e.next=3,f.a.get("annotations/get-image-data-by-user",{headers:{Authorization:"bearer ".concat(localStorage.getItem("jwt"))},params:{annotate_mode:this.state.annotatemode,call_type:t,curr_image_index:"first"===t?0:this.state.curr_image_index,image_key:a}}).then(function(e){console.log("[".concat(t,"]"),e),r=e,e.data.error?(i.setState({loading:!1}),A()({title:e.data.error,text:"come back later",icon:"warning",buttons:!0})):(localStorage.setItem("metadata",JSON.stringify(e.data.metadata)),i.toArrayBuffer(e.data.image.data).then(function(t){var a=new Blob([t],{type:"image/jpeg"});o=URL.createObjectURL(a),i.getImageSize(o).then(function(t){n=t;var a=[];null!=e.data.annotations?(e.data.annotations.obj_detect||e.data.annotations.segmentation?"object_detection"===i.state.annotatemode?e.data.annotations.obj_detect.map(function(e,n){a.push({cls:e.Class_Name,highlighted:!1,id:i.getRandomId(),x:e.Region[0]/t.imgWidth,y:e.Region[1]/t.imgHeight,w:e.Region[2]/t.imgWidth,h:e.Region[3]/t.imgHeight,color:"hsl(82,100%,50%)",type:"box"})}):e.data.annotations.segmentation.map(function(e,n){var o=[];e.Region.map(function(e,a){o.push([e[0]/t.imgWidth,e[1]/t.imgHeight])}),a.push({cls:e.Class_Name,highlighted:!1,id:i.getRandomId(),points:o,color:"hsl(82,100%,50%)",type:"polygon"})}):"object_detection"===i.state.annotatemode?e.data.annotations.map(function(e,n){a.push({cls:e.cls,highlighted:!1,id:e.id,x:e.x/t.imgWidth,y:e.y/t.imgHeight,w:e.w/t.imgWidth,h:e.h/t.imgHeight,color:"hsl(82,100%,50%)",type:"box"})}):e.data.annotations.map(function(e,n){var o=[];e.points.map(function(e,a){o.push([e[0]/t.imgWidth,[e[1]/t.imgHeight]])}),a.push({cls:e.cls,highlighted:!1,id:e.id,points:o,color:"hsl(82,100%,50%)",type:"polygon"})}),console.log("[generarted regions]",a),i.setState({curr_image_index:i.state.curr_image_index,src:o,regions:a,metadata:e.data.metadata,image_key:e.data.image_key,dimension:t,loading:!1})):(i.setState({loading:!1}),A()({title:"NO Annotations",icon:"warning",buttons:!0}),i.setState({curr_image_index:i.state.curr_image_index,src:o,regions:null,metadata:e.data.metadata,image_key:e.data.image_key,dimension:t,loading:!1}))}).catch(function(t){i.setState({curr_image_index:i.state.curr_image_index,src:o,regions:null,metadata:e.data.metadata,image_key:e.data.image_key,dimension:n,loading:!1}),"Cannot read property 'map' of undefined"!==t.message&&A()({title:i.titleHandler(t),icon:"warning",buttons:!0})})}).catch(function(t){i.setState({curr_image_index:i.state.curr_image_index,src:o,regions:null,metadata:e.data.metadata,image_key:e.data.image_key,dimension:n,loading:!1}),A()({title:i.titleHandler(t),icon:"warning",buttons:!0})}))}).catch(function(e){i.setState({curr_image_index:i.state.curr_image_index,src:o,regions:null,metadata:r.data.metadata,image_key:r.data.image_key,dimension:n,loading:!1}),A()({title:i.titleHandler(e),buttons:!0})});case 3:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(B.a)(W.a.mark(function e(){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("did mount"),e.next=3,this.get_class("global");case 3:try{"first"===this.state.call_type&&(this.setState({loading:!0,message:"Fetching Image for annotation"}),localStorage.removeItem("checkList"),this.main_api("first","first"),this.setState({call_type:"previous"}))}catch(t){console.log(t.response),alert("could'nt load image")}case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.message,n=e.metadata,r=e.allowed_metadata,i=e.previewList,c=e.curr_image_index,l=e.annotatemode,s=e.class_list,u=e.src,m=e.regions;return o.a.createElement(_n,{loading:t,message:a,metadata:n,allowed_metadata:r,preview:this.preview,previewList:i,curr_image_index:c,changeAnnotateMode:this.changeAnnotateMode,annotatemode:l,allowedArea:{x:0,y:0,w:1,h:1},taskDescription:"Annotate the imaes by selecting the mode for object detection or segmentationl",images:[{src:u,name:"Task:Enter the Metadata First then Annotate",regions:m}],regionClsList:s,onPrevImage:this.prevImage,onNextImage:this.nextImage,onExit:this.checkImage})}}]),t}(n.Component),Nn=(a(500),a(168)),Cn=a.n(Nn),kn=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(u.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).state={redirectTo:!1},a.logout=function(){console.log("logging out"),localStorage.removeItem("jwt"),a.props.updateUser({loggedIn:!1,username:null})},a.confirmLogout=function(){A()({title:"Are you sure to Logout?",icon:"warning",buttons:!0,dangerMode:!0}).then(function(e){e?a.logout():A()("You are loggedIn !")})},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){this.props.loggedIn;return this.state.redirectTo?o.a.createElement(G.a,{to:"/"}):o.a.createElement("div",{className:"w3-bar w3-black"},o.a.createElement("a",{className:"w3-bar-item"},o.a.createElement("img",{src:_.a,className:"App-logo",alt:"logo"}),o.a.createElement("strong",null,o.a.createElement("span",{className:"w3-text-red"},"AUTO"),"\xa0"),o.a.createElement("strong",null,o.a.createElement("span",null,"ANNOTATION"))),o.a.createElement("button",{className:"w3-bar-item w3-button w3-hover-dark-gray  w3-right",onClick:this.confirmLogout},o.a.createElement(Cn.a,null),o.a.createElement("div",null,"LogOut")))}}]),t}(n.Component),An=Object(G.f)(kn),Mn=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(m.a)(t).call(this,e))).state={hasError:!1},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidCatch",value:function(e,t){alert(e)}},{key:"render",value:function(){return this.state.hasError?o.a.createElement("h1",null,"Something went wrong."):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(o.a.Component),Ln=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.loggedIn,t=this.props.updateUser;return e?o.a.createElement("div",null,o.a.createElement(Mn,null,o.a.createElement(An,{updateUser:t,loggedIn:e})),o.a.createElement(Mn,null,o.a.createElement(Tn,null))):o.a.createElement(G.a,{to:"/"})}}]),t}(n.Component),Rn=Object(G.f)(Ln);function Pn(){return o.a.createElement(j.a,{variant:"body2",color:"textSecondary",align:"center"},"Copyright \xa9 ",o.a.createElement(c.b,{color:"inherit",href:"https://fluxauto.xyz/"},"www.fluxauto.xyz")," ",(new Date).getFullYear(),".")}var Dn=Object(I.a)(function(e){return{root:{height:"100vh"},image:{backgroundImage:"url(".concat(_.a,")"),backgroundRepeat:"no-repeat",backgroundColor:"black",backgroundSize:"500px 500px",backgroundPosition:"center"},paper:{margin:e.spacing(8,4),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},maindiv:{backgroundImage:"url(".concat(N.a,")")}}});var Wn=Object(G.f)(function(e){var t=Dn(),a=Object(n.useState)(!1),r=Object(p.a)(a,2),i=r[0],l=r[1],s=Object(n.useState)(null),u=Object(p.a)(s,2),m=u[0],d=u[1],g=Object(n.useState)(null),h=Object(p.a)(g,2),E=h[0],I=h[1],S=Object(n.useState)(null),_=Object(p.a)(S,2),T=_[0],N=_[1],k=function(e){switch(e.message){case"Request failed with status code 401":return"Incorect Username or Password";default:return e.message}};return localStorage.getItem("jwt")&&f.a.get("/user",{headers:{Authorization:"bearer ".concat(localStorage.getItem("jwt"))}}).then(function(t){200===t.status&&(e.updateUser({loggedIn:!0,username:t.data.username}),N("/user"))}).catch(function(e){l(!1),alert("login in again session expired")}),T?o.a.createElement(G.a,{to:{pathname:T}}):i?o.a.createElement(C,{message:"logging in please wait"}):o.a.createElement(x.a,{container:!0,component:"main",className:t.root},o.a.createElement(v.a,null),o.a.createElement(x.a,{item:!0,xs:!1,sm:4,md:7,className:t.image}),o.a.createElement(x.a,{item:!0,xs:12,sm:8,md:5,component:O.a,elevation:6,square:!0},o.a.createElement("div",{className:t.paper},o.a.createElement("div",null,o.a.createElement("h2",{className:"w3-text-red"},"AUTO"),o.a.createElement("h2",null,"ANNOTATION")),o.a.createElement(j.a,{component:"h1",variant:"h5"},"Sign in"),o.a.createElement("form",{className:t.form},o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,id:"email",label:"User Name",name:"email",autoComplete:"email",onChange:function(e){d(e.target.value)},autoFocus:!0,required:!0}),o.a.createElement(y.a,{variant:"outlined",margin:"normal",fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",onChange:function(e){I(e.target.value)},autoComplete:"current-password",required:!0}),o.a.createElement(b.a,{type:"submit",fullWidth:!0,onClick:function(t){t.preventDefault();var a=e.history;m&&null!==E?(l(!0),f.a.post("/user/login",{username:m,password:E}).then(function(t){200===t.status&&(l(!1),e.updateUser({loggedIn:!0,username:t.data.username}),localStorage.setItem("jwt",t.data.token),N("/user"))}).catch(function(e){l(!1),A()({title:k(e),icon:"warning",buttons:!0}),a.push("/")})):A()({title:"All fields are Mandatory",icon:"warning",buttons:!0})},variant:"contained",color:"primary",className:t.submit},"Sign In"),o.a.createElement(x.a,{container:!0},o.a.createElement(x.a,{item:!0,xs:!0},o.a.createElement(c.b,{to:"/forgot-password",variant:"body2"},"Forgot password?")),o.a.createElement(x.a,{item:!0},o.a.createElement(c.b,{to:"/signup",variant:"body2"},"Don't have an account? Sign Up"))),o.a.createElement(w.a,{mt:5},o.a.createElement(Pn,null))))))}),Bn=function(e){function t(){var e;return Object(l.a)(this,t),(e=Object(u.a)(this,Object(m.a)(t).call(this))).state={loggedIn:!1,username:null},e.updateUser=e.updateUser.bind(Object(g.a)(Object(g.a)(e))),e}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("jwt");f.a.get("/user",{headers:{Authorization:"bearer ".concat(t)}}).then(function(t){t.data.user&&e.setState({loggedIn:!0})}).catch(function(e){"jwt expired"!==e.response.data.message||alert("Token has Expired please LogIn again")})}},{key:"updateUser",value:function(e){this.setState(e)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement(c.a,null,o.a.createElement(G.b,{exact:!0,path:"/user",render:function(){return o.a.createElement(Rn,{updateUser:e.updateUser,loggedIn:e.state.loggedIn})}}),o.a.createElement(G.b,{exact:!0,path:"/",render:function(){return o.a.createElement(Wn,{updateUser:e.updateUser})}}),o.a.createElement(G.b,{exact:!0,path:"/signup",component:Y}),o.a.createElement(G.b,{exact:!0,path:"/forgot-password",component:R}),o.a.createElement(G.b,{exact:!0,path:"/reset/:token",component:V})))}}]),t}(n.Component);i.a.render(o.a.createElement(c.a,null,o.a.createElement(Bn,null)),document.getElementById("root"))},85:function(e,t,a){e.exports=a.p+"static/media/logo.00d8ec7f.png"}},[[275,1,2]]]);
//# sourceMappingURL=main.380bd805.chunk.js.map